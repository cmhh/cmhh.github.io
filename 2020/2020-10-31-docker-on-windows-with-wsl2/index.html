<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>cmhh  | Docker on Windows with Windows Subsystem for Linux 2</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css" />
    <link href="../../css/highlight/atom-one-dark-reasonable.css" rel='stylesheet' type='text/css' />
    <link rel="stylesheet" href="../../css/blog.css" />
    <link rel="stylesheet" href="../../css/custom.css" />
</head>
<body>

    
    <nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="../../">Home</a>
            
        </div>
    </nav>
    

    
    <section class="hero is-info is-medium">
        <div class="hero-body" style="background-image: url(/img/bg-blog-2.jpg);">
            <div class="container has-text-centered">
                <br>
                <h1 class="title is-size-1">
                    
                        Docker on Windows with Windows Subsystem for Linux 2
                    
                </h1>
                
            </div>
        </div>
    </section>


<div class="container">
    <div class="section">
    

<div class="columns">
    <div class="column is-9">
        <div class="tile is-child box">
            <div class="content">
                <h1 id="overview">Overview</h1>
<p>Windows Subsystem for Linux version 2 (WSL2) brings something like a native Linux environment to Windows.  And because it&rsquo;s native, we can even run Docker on WSL2 and access the running containers from the Windows host without hassle.</p>
<h1 id="dependencies">Dependencies</h1>
<p>All that is required to run WSL2 is Windows Server 2019 or higher, or Windows 10 (any edition) build 2004 or higher.  And, of course, we must also install a working Linux distribution.  In addition to this, the following are useful additions:</p>
<ul>
<li>enable <a href="https://docs.microsoft.com/en-us/windows-server/administration/openssh/openssh_install_firstuse">OpenSSH client</a></li>
<li>install <a href="https://sourceforge.net/projects/vcxsrv/">VcXsrv</a></li>
<li>install <a href="https://code.visualstudio.com/">Visual Studio Code</a>, with remote SSH and WSL extensions</li>
</ul>
<p>OpenSSH allows one to work with remote instances.  Such instances could be Docker images running locally inside WSL2, so the term &lsquo;remote&rsquo; is used very loosely.</p>
<p>VcXsrv is an X11 client for Windows.  It should be considered optional, but it allows one to use native Linux GUI apps that are installed inside WSL2.  It should be noted that a future version of WSL2 will support native GUIs (presumably by bundling VcXsrv or Xming), so this will become unnecessary at some point.</p>
<p>Finally, Visual Studio Code (vscode) is an extensible text editor developed by Microsoft.  In particular, Microsoft have developed an extension that enables one to use a locally installed version of vscode as an IDE for WSL2.</p>
<h2 id="enable-openssh-client">Enable OpenSSH client</h2>
<p>To confirm OpenSSH is available for install, open PowerShell as administrator and run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ps" data-lang="ps">&gt; <span style="color:#a6e22e">Get-WindowsCapability</span> <span style="color:#a6e22e">-Online</span> <span style="color:#a6e22e">|</span> <span style="color:#a6e22e">?</span> <span style="color:#a6e22e">Name</span> <span style="color:#a6e22e">-like</span> <span style="color:#a6e22e">&#39;OpenSSH*&#39;</span>
</code></pre></div><p>If OpenSSH is available, you&rsquo;ll see something like:</p>
<pre><code>Name  : OpenSSH.Client~~~~0.0.1.0
State : Installed

Name  : OpenSSH.Server~~~~0.0.1.0
State : NotPresent
</code></pre><p>To enable OpenSSH, run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ps" data-lang="ps">&gt; <span style="color:#a6e22e">Add-WindowsCapability</span> <span style="color:#a6e22e">-Online</span> <span style="color:#a6e22e">-Name</span> <span style="color:#a6e22e">OpenSSH.Client~~~~0.0.1.0</span>
</code></pre></div><h2 id="enable-wsl2">Enable WSL2</h2>
<p>To enable WSL2, open PowerShell as administrator and run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ps" data-lang="ps">&gt; <span style="color:#a6e22e">dism.exe</span> /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
&gt; <span style="color:#a6e22e">dism.exe</span> /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
</code></pre></div><p>You will need to restart Windows at this point.  After rebooting, download and run the following installer:</p>
<p><a href="https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi">WSL2 Linux Kernel</a></p>
<p>Then, open PowerShell as administrator and run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ps" data-lang="ps">&gt; <span style="color:#a6e22e">wsl</span> <span style="color:#a6e22e">--set-default-version</span> <span style="color:#ae81ff">2</span>
</code></pre></div><p><a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">https://docs.microsoft.com/en-us/windows/wsl/install-win10</a></p>
<h2 id="install-ubuntu-2004-sans-windows-store">Install Ubuntu 20.04 (sans Windows Store)</h2>
<p>Installing a Linux distribution is easily done via the Windows Store.  However, in an enterprise environment where Store access is limited, or where one simply does not wish to use the Store, one can still download distributions directly, as listed:</p>
<p><a href="https://docs.microsoft.com/en-us/windows/wsl/install-manual">Manually download Windows Subsystem for Linux distro packages</a></p>
<p>In our case, we download Ubuntu 20.04, which is the current LTS version of Ubuntu:</p>
<p><a href="https://aka.ms/wslubuntu2004">Ubuntu 20.04</a></p>
<p>We&rsquo;ll install Ubuntu in <code>C:\Program Files\Linux</code>, though perhaps users might rather place it somewhere in their own user directory.  To create this folder, and then download the above file from PowerShell run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ps" data-lang="ps">&gt; <span style="color:#a6e22e">mkdir</span> <span style="color:#a6e22e">&#39;c:\Program</span> <span style="color:#a6e22e">Files\Linux&#39;</span>
&gt; <span style="color:#a6e22e">cd</span> <span style="color:#a6e22e">&#39;c:\Program</span> <span style="color:#a6e22e">Files\Linux&#39;</span>
&gt; <span style="color:#a6e22e">curl.exe</span> <span style="color:#a6e22e">-L</span> <span style="color:#a6e22e">-o</span> <span style="color:#a6e22e">ubuntu-2004.appx</span> <span style="color:#a6e22e">https:</span><span style="color:#960050;background-color:#1e0010">/</span>/aka.ms/wslubuntu2004
</code></pre></div><p>It seems an <code>appx</code> file is just a zip archive, so rename the file and unzip it from PowerShell by running:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ps" data-lang="ps">&gt; <span style="color:#a6e22e">Rename-Item</span> <span style="color:#a6e22e">.\ubuntu-2004.appx</span> <span style="color:#a6e22e">.\ubuntu-2004.zip</span>
&gt; <span style="color:#a6e22e">Expand-Archive</span> <span style="color:#a6e22e">.\ubuntu-2004.zip</span> <span style="color:#a6e22e">.\ubuntu2004</span>
</code></pre></div><p>To start Ubuntu, run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ps" data-lang="ps">&gt; <span style="color:#a6e22e">.\ubuntu2004\ubuntu2004.exe</span>
</code></pre></div><p>The first time Ubuntu is run you will be prompted to add a username and password.  It doesn&rsquo;t really matter what you choose, but either way you&rsquo;ll see something like the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ps" data-lang="ps">&gt; <span style="color:#a6e22e">.\ubuntu2004\ubuntu2004.exe</span>
</code></pre></div><pre><code>Installing, this may take a few minutes...
Please create a default UNIX user account. The username does not need to match your Windows username.
For more information visit: https://aka.ms/wslusers
Enter new UNIX username: cxhansen
New password:
Retype new password:
passwd: password updated successfully
Installation successful!
To run a command as administrator (user &quot;root&quot;), use &quot;sudo &lt;command&gt;&quot;.
See &quot;man sudo_root&quot; for details.

Welcome to Ubuntu 20.04 LTS (GNU/Linux 4.19.104-microsoft-standard x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Sat Jul 18 14:43:16 NZST 2020

  System load:  0.16               Processes:             8
  Usage of /:   0.4% of 250.98GB   Users logged in:       0
  Memory usage: 1%                 IPv4 address for eth0: 172.27.186.14
  Swap usage:   0%

0 updates can be installed immediately.
0 of these updates are security updates.


The list of available updates is more than a week old.
To check for new updates run: sudo apt update


This message is shown once once a day. To disable it please create the
/home/cxhansen/.hushlogin file.
cxhansen@DESKTOP-FA4F6IC:~$
</code></pre><p>If Ubuntu is the only distribution installed, or it is the default distribution, simply running <code>wsl</code> from PowerShell will be enough to start it.  The available distributions can be listed by running <code>wsl -d</code>.  In this case, with only Ubuntu 20.04 installed so far, the output is as follows:</p>
<pre><code>Windows Subsystem for Linux Distributions:
Ubuntu-20.04 (Default)
</code></pre><p>If more distributions were available, Ubuntu 20.04 could be started by running:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ps" data-lang="ps">&gt; <span style="color:#a6e22e">wsl</span> <span style="color:#a6e22e">-d</span> <span style="color:#a6e22e">Ubuntu-20.04</span>
</code></pre></div><p>and Ubuntu 20.04 can be set as the default by running:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ps" data-lang="ps">&gt; <span style="color:#a6e22e">wsl</span> <span style="color:#a6e22e">-s</span> <span style="color:#a6e22e">Ubuntu-20.04</span>
</code></pre></div><h2 id="install-docker-on-ubuntu-2004">Install Docker on Ubuntu 20.04</h2>
<p>Docker is available in the standard Ubuntu repositories, but it can be useful to use the official repositories instead.  Docker has some prerequisites, which can be installed as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo apt update
$ sudo apt -y install <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    apt-transport-https ca-certificates curl gnupg-agent <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    software-properties-common
</code></pre></div><p>Then add the Docker repositories, and install Docker:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
$ sudo apt-key fingerprint 0EBFCD88
$ sudo add-apt-repository <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>   <span style="color:#e6db74">&#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu \
</span><span style="color:#e6db74">   </span><span style="color:#66d9ef">$(</span>lsb_release -cs<span style="color:#66d9ef">)</span><span style="color:#e6db74"> \
</span><span style="color:#e6db74">   stable&#34;</span>
$ sudo apt update
$ sudo DEBIAN_FRONTEND<span style="color:#f92672">=</span>noninteractive <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    apt -y install <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    docker-ce docker-ce-cli containerd.io
</code></pre></div><p>In order to run Docker without using <code>sudo</code>, relevant users can be added to the Docker group:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ usermod -aG docker &lt;user&gt; 
</code></pre></div><p>The Docker daemon will not start automatically as for a standard Ubuntu installation, but it can be started manually by running:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo service docker start
</code></pre></div><p>To confirm it is running:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo service docker status
</code></pre></div><pre><code> * Docker is running
</code></pre><p>And to confirm it works:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ docker run hello-world
</code></pre></div><pre><code>Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/
</code></pre><h2 id="install-docker-compose-on-ubuntu-2004">Install Docker Compose on Ubuntu 20.04</h2>
<p>Docker Compose is a utility that allows one to coordinate the use of several containers, that is, to effectively treat several containers as a single runnable unit.  To install:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo curl -L <span style="color:#ae81ff">\ </span>
    <span style="color:#e6db74">&#34;https://github.com/docker/compose/releases/download/1.26.2/docker-compose-</span><span style="color:#66d9ef">$(</span>uname -s<span style="color:#66d9ef">)</span><span style="color:#e6db74">-</span><span style="color:#66d9ef">$(</span>uname -m<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    -o /usr/local/bin/docker-compose
$ chmod +x /usr/local/bin/docker-compose
$ docker-compose --version
</code></pre></div><pre><code>docker-compose version 1.26.2, build eefe0d31
</code></pre><h2 id="install-visual-studio-code">Install Visual Studio Code</h2>
<p>Installing vscode is straightforwardâ€“simply run the installer found <a href="https://code.visualstudio.com/download">at the vscode website</a>.  When running vscode for the first time, one might see the following prompt:</p>
<div class=small>
<img src=assets/vscode01.png>
</div>
<p>Choose &lsquo;Install&rsquo; to install the extension.  Otherwise, press CTRL+SHIFT+X and search for &lsquo;wsl&rsquo;:</p>
<p><img src="assets/vscode02.png" alt=""></p>
<p>Many other useful extensions are available, including &lsquo;Remote - SSH&rsquo;, which allows one to edit files on any remote machine which is accessible by SSH.</p>
<p>When the WSL extension is installed, one can simply issue <code>CODE &lt;folder&gt; &amp;</code> from within a running WSL instance to start vscode on the host machine:</p>
<p><img src="assets/vscode03.png" alt=""></p>
<h2 id="install-vcxsrv">Install VcXsrv</h2>
<p>To install VcXsrv, simply download and run the installer from  <a href="https://sourceforge.net/projects/vcxsrv/files/latest/download">the VcXsrv download page</a>.</p>
<p>Note that VcXsrv works best with WSL2 if it is started with certain switches.  Specifically, one should ensure the target is as follows (adapt as required if VcXsrv was installed in a different folder):</p>
<pre><code>&quot;C:\Program Files\VcXsrv\vcxsrv.exe&quot; :0 -ac -terminate -lesspointer -multiwindow -clipboard -wgl
</code></pre><p>From inside the running Linux instance, one should also set the <code>DISPLAY</code> environment variable as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ export DISPLAY<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>awk <span style="color:#e6db74">&#39;/nameserver / {print $2; exit}&#39;</span> /etc/resolv.conf 2&gt; /dev/null<span style="color:#66d9ef">)</span>:0
</code></pre></div><p>It should then be possible to run graphical applications using the host display:</p>
<p><img src="assets/vscode04.png" alt=""></p>
<h2 id="complete-linux-desktop">Complete Linux Desktop</h2>
<p>We can go further than simply opening graphical applications, and start a full-blown desktop.  It&rsquo;s pretty involved, so we won&rsquo;t cover it here.  But those interested could read, for example:</p>
<p><a href="https://most-useful.com/ubuntu-20-04-desktop-gui-on-wsl-2-on-surface-pro-4/">Ubuntu 20.04 Desktop GUI on WSL 2 on Surface Pro 4</a></p>
<p><img src="assets/desktop03.png" alt="Ubuntu desktop on a Surface Pro!"></p>
<h1 id="some-comments-on-docker">Some Comments on Docker</h1>
<p>Being able to access an isolated Linux environment via WSL2 brings considerable potential end-user enablement.  But given Docker on Linux is a software abstraction, we can install a working version of Docker inside our Linux distribution relatively easily, and there are good reasons for doing so.</p>
<p>One might want to develop an application, and in doing so one might make use of a particular tool or framework that has no further use beyond the application in question.  In this case, there is little point installing the tool generally, and littering the Linux host.  Or, different applications might require different versions of the same tool, but it is not easy in practice to have multiple versions coexist.  These use cases, and many others, are particularly well suited to containerisation.</p>
<p>Besides all this, a container is an excellent unit of deployment in general.  One can commit containers to a container registry, or else commit the source (in the case of Docker, a so-called Dockerfile containing the recipe for building an image) to version control systems such as GitLab.  GitLab has built-in CI/CD tools that can be utilised to automate the build and deployment of containers, including to container registries.  Ace.</p>
<p>Personally, I use Docker to keep form cluttering the host OS in general.  That is, I like to keep the host relatively pristine, and often use tools like databases or data science environments within the context of a container.  In an enterprise environment, the benefit of this approach in keeping the amount of support required down should be relatively obvious.</p>
<h1 id="miscellaneous">Miscellaneous</h1>
<p>It seems it is possible for the time in WSL to be out of sync with the system clock, and this can cause some issues.  For example, Debian packages will sometimes fail to download.  To fix this, run the following from the WSL terminal:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo hwclock --hctosys
</code></pre></div><h1 id="example---run-a-local-rstudio-server-instance">Example - Run a local RStudio Server Instance</h1>
<p>Rather than install R directly, we instead run R via Docker.  In practice, we might have a standard R container that roughly replicates the existing server environment, and which ensures a consistent, but local, experience for anybody who cares to use it.  As a demonstration, we build a container called <code>rstudio</code>.  The demo is not yet a complete enterprise solution, but it is certainly usable, and it demonstrates the following:</p>
<ul>
<li>the use of a specific Linux distribution and version</li>
<li>the use of a specific version of R (built from source)</li>
<li>the use of a specific version of RStudio Server</li>
<li>TinyTex $\LaTeX$ installation (much smaller than texlive)</li>
<li>a number of host dependencies, such as libgdal-dev.</li>
</ul>
<p>The complete <code>Dockerfile</code> is as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="color:#66d9ef">ARG</span> ubuntu_version<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>.04<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> ubuntu:$ubuntu_version</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ARG</span> cores<span style="color:#f92672">=</span><span style="color:#ae81ff">12</span>
<span style="color:#66d9ef">ARG</span> r_version<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>.0.2<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ARG</span> rstudio_version<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>.3.1056<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> DEBIAN_FRONTEND<span style="color:#f92672">=</span>noninteractive
<span style="color:#66d9ef">ENV</span> SHELL<span style="color:#f92672">=</span>/bin/bash<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> R_VERSION<span style="color:#f92672">=</span>$r_version<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> RSTUDIO_VERSION<span style="color:#f92672">=</span>$rstudio_version<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># install necessary packages</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span>  apt-get update <span style="color:#f92672">&amp;&amp;</span> apt-get -y dist-upgrade <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  apt-get install -y --no-install-recommends <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    gnupg2 dirmngr ca-certificates build-essential <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libblas3 libcairo2-dev <span style="color:#e6db74">&#39;^perl-modules-[0-9].[0-9]+$&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libssl-dev libgit2-dev libcurl4-gnutls-dev libxml2-dev curl wget htop locales <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    openjdk-8-jdk python3-pip git vim libudunits2-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    grass gdal-bin libgdal-dev libgeos-dev libproj-dev proj-bin proj-data <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libblas3 libatlas-base-dev liblapack-dev libreadline-dev gfortran <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    libx11-dev libxt-dev zlib1g-dev libbz2-dev liblzma-dev libpcre2-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    sudo lsb-release gdebi-core psmisc libclang-dev libapparmor1 <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  apt-get clean <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  rm -rf /var/lib/apt/lists/* <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  sed -i -e <span style="color:#e6db74">&#39;s/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/&#39;</span> /etc/locale.gen <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  dpkg-reconfigure --frontend<span style="color:#f92672">=</span>noninteractive locales <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  update-locale LANG<span style="color:#f92672">=</span>en_US.UTF-8 <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  wget -qO- <span style="color:#e6db74">&#34;https://yihui.org/gh/tinytex/tools/install-unx.sh&#34;</span> | sh -s - --admin --no-path <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  mv /root/.TinyTeX /usr/local/TinyTex <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  /usr/local/TinyTex/bin/*/tlmgr path add <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  mkdir /src <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  cd /src <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  wget https://cran.r-project.org/src/base/R-<span style="color:#66d9ef">$(</span>echo $R_VERSION | cut -d<span style="color:#e6db74">&#39;.&#39;</span> -f 1<span style="color:#66d9ef">)</span>/R-<span style="color:#e6db74">${</span>R_VERSION<span style="color:#e6db74">}</span>.tar.gz <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  tar -xvf R-<span style="color:#e6db74">${</span>R_VERSION<span style="color:#e6db74">}</span>.tar.gz <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  cd /src/R-<span style="color:#e6db74">${</span>R_VERSION<span style="color:#e6db74">}</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  ./configure --enable-R-shlib --with-blas --with-lapack --enable-memory-profiling --with-cairo <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  make -j $cores <span style="color:#f92672">&amp;&amp;</span> make install <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  ln -s /usr/local/lib/R/bin/R /usr/bin/R <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  ln -s /usr/local/lib/R/bin/Rscript /usr/bin/Rscript <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  cd / <span style="color:#f92672">&amp;&amp;</span> rm -fR src <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  echo <span style="color:#e6db74">&#34;local({\n  r &lt;- getOption(&#39;repos&#39;)\n  r[&#39;CRAN&#39;] &lt;- &#39;https://cloud.r-project.org&#39;\n  options(repos = r)\n})&#34;</span> &gt; /usr/local/lib/R/etc/Rprofile.site <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  echo <span style="color:#e6db74">&#34;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&#34;</span> &gt; /usr/local/lib/R/etc/Renviron.site <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  R -e <span style="color:#e6db74">&#34;install.packages(&#39;renv&#39;)&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  wget https://download2.rstudio.org/server/bionic/amd64/rstudio-server-<span style="color:#e6db74">${</span>RSTUDIO_VERSION<span style="color:#e6db74">}</span>-amd64.deb <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  gdebi --non-interactive rstudio-server-<span style="color:#e6db74">${</span>RSTUDIO_VERSION<span style="color:#e6db74">}</span>-amd64.deb <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  rm rstudio-server-<span style="color:#e6db74">${</span>RSTUDIO_VERSION<span style="color:#e6db74">}</span>-amd64.deb<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># add user for demo purposes</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> adduser --disabled-password --gecos <span style="color:#e6db74">&#34;&#34;</span> guest <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  usermod --password <span style="color:#66d9ef">$(</span>openssl passwd -1 guest<span style="color:#66d9ef">)</span> guest <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  usermod -aG sudo guest <span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 8787</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> service rstudio-server start <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  tail -f /dev/null<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>This Dockerfile can be built differently depending on build arguments.  For example, we could build a version with Ubuntu 18.04 and R 3.6.3 as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker build <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -t rstudio:ubuntu18.04-3.6.3 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --build-arg ubuntu_version<span style="color:#f92672">=</span>18.04 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --build-arg r_version<span style="color:#f92672">=</span>3.6.3 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --build-arg cores<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  .
</code></pre></div><p>(The cores argument dictates how many cores are used when compiling R from source.)  To run this image with a persistent renv cache and R workspace, we could then run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run -d --rm --name rstudio <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -p 8787:8787 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -v /home/cxhansen/renvcache:/home/guest/.local/share/renv <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -v /home/cxhansen/Projects:/home/guest/My-Local-Workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  rstudio:ubuntu18.04-3.6.3
</code></pre></div><p>But we could just as easily build an image instead using Ubuntu 20.04, say, and R 4.0.2:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker build <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -t rstudio:ubuntu20.04-4.0.2 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --build-arg ubuntu_version<span style="color:#f92672">=</span>20.04 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --build-arg r_version<span style="color:#f92672">=</span>4.0.2 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --build-arg cores<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  .
</code></pre></div><p>and then run that, perhaps simultaneously, on a different local port:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run -d --rm --name rstudio <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -p 8788:8787 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -v /home/cxhansen/renvcache:/home/guest/.local/share/renv <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -v /home/cxhansen/Projects:/home/guest/My-Local-Workspace <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  rstudio:ubuntu20.04-4.0.2
</code></pre></div><p>Assuming such instances are running, we simply open a browser at <code>localhost:8787</code> or <code>localhost:8788</code> to access RStudio Server.</p>
<video width="878" controls>
  <source src="../../vid/rstudio-docker-01.mp4" type="video/mp4">
Your browser does not support the video tag.
</video>
            </div>
        </div>
    </div>
    <div class="column is-3">
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Tags</h1>
        <div class="tags">
        
            <span class="tag"><a href="../../tags/akka-http">akka-http</a></span>
        
            <span class="tag"><a href="../../tags/docker">docker</a></span>
        
            <span class="tag"><a href="../../tags/geoserver">geoserver</a></span>
        
            <span class="tag"><a href="../../tags/geospark">geospark</a></span>
        
            <span class="tag"><a href="../../tags/geospatial">geospatial</a></span>
        
            <span class="tag"><a href="../../tags/nodejs">nodejs</a></span>
        
            <span class="tag"><a href="../../tags/osrm">osrm</a></span>
        
            <span class="tag"><a href="../../tags/postgis">postgis</a></span>
        
            <span class="tag"><a href="../../tags/postgresql">postgresql</a></span>
        
            <span class="tag"><a href="../../tags/qgis">qgis</a></span>
        
            <span class="tag"><a href="../../tags/r">r</a></span>
        
            <span class="tag"><a href="../../tags/r-packages">r-packages</a></span>
        
            <span class="tag"><a href="../../tags/seasonal-adjustment">seasonal-adjustment</a></span>
        
            <span class="tag"><a href="../../tags/sedona">sedona</a></span>
        
            <span class="tag"><a href="../../tags/shiny">shiny</a></span>
        
            <span class="tag"><a href="../../tags/spark">spark</a></span>
        
            <span class="tag"><a href="../../tags/tiles">tiles</a></span>
        
            <span class="tag"><a href="../../tags/tilestache">tilestache</a></span>
        
            <span class="tag"><a href="../../tags/vuejs">vuejs</a></span>
        
            <span class="tag"><a href="../../tags/wmts">wmts</a></span>
        
            <span class="tag"><a href="../../tags/wsl2">wsl2</a></span>
        
            <span class="tag"><a href="../../tags/x13-arima-seats">x13-arima-seats</a></span>
        
        </div>          
    </div>
</div><br>
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Recent posts</h1>
        
            <h1><a href="../../2021/2021-04-19-a-brief-look-at-apache-sedona/">A Brief Look at Apache Sedona</a></h1>
            <time class="has-text-grey-light is-size-7">19 April 2021</time>
        
            <h1><a href="../../2020/2020-12-05-working-productively-on-windows-using-wsl2-and-docker/">Working Productively on Windows Using Windows Subsystem for Linux 2 and Docker</a></h1>
            <time class="has-text-grey-light is-size-7">5 December 2020</time>
        
            <h1><a href="../../2020/2020-10-31-using-postgis-as-a-spatial-backend-for-r/">Using PostGIS as a Spatial Backend for R</a></h1>
            <time class="has-text-grey-light is-size-7">31 October 2020</time>
        
            <h1><a href="../../2020/2020-10-31-docker-on-windows-with-wsl2/">Docker on Windows with Windows Subsystem for Linux 2</a></h1>
            <time class="has-text-grey-light is-size-7">31 October 2020</time>
        
            <h1><a href="../../2020/2020-06-01-seasonal-adjustment-as-a-service/">Seasonal Adjustment as a Service</a></h1>
            <time class="has-text-grey-light is-size-7">1 June 2020</time>
        
    </div>
</div>
    <br>
                
  



<div class="card">
    <div class="card-content">
        <h1 class="title is-5">Related posts</h1>
      
      
            <h1><a href="../../2020/2020-12-05-working-productively-on-windows-using-wsl2-and-docker/">Working Productively on Windows Using Windows Subsystem for Linux 2 and Docker</a></h1>
            <time class="has-text-grey-light is-size-7">5 December 2020</time>
      
    </div>
</div>

    
<br>
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Archives</h1>
        
            <a href="../../archives/2021">2021</a> (1)<br>
        
            <a href="../../archives/2020">2020</a> (4)<br>
        
            <a href="../../archives/2019">2019</a> (1)<br>
        
            <a href="../../archives/2017">2017</a> (1)<br>
        
            <a href="../../archives/2016">2016</a> (4)<br>
        
    </div>
</div>

    </div>
</div>


    </div>
</div>

<footer class="footer has-background-grey-darker has-text-white">
    <div class="content has-text-centered">
        <p>
            <span class="icon is-large"><a href="https://github.com/cmhh" class="mysocial" rel="me"><i class="fab fa-github fa-3x"></i></a></span>&nbsp;&nbsp;
            <span class="icon is-large"><a href="mailto://cmhhansen@outlook.com" class="mysocial" rel="me"><i class="fas fa-envelope fa-3x"></i></a></span>&nbsp;&nbsp;
            <br><br>
            Copyright &copy; cmhh 2021 - Theme by <a href="https://jeffprod.com" class="mysocial">JeffProd.com</a>
        </p>
    </div>
</footer>

<script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js"></script>
<script src="../../js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script src="//yihui.org/js/math-code.js"></script>
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

</body>
</html>
