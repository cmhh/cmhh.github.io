<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>cmhh</title>
    <link>/categories/r/index.xml</link>
    <description>Recent content on cmhh</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <atom:link href="/categories/r/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Routing in R Using the Open Source Routing Machine (OSRM)</title>
      <link>/post/routing/</link>
      <pubDate>Sun, 27 Nov 2016 00:00:00 +0000</pubDate>
      
      <guid>/post/routing/</guid>
      <description>&lt;!-- BLOGDOWN-BODY-BEFORE

/BLOGDOWN-BODY-BEFORE --&gt;

&lt;div id=&#34;overview&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Overview&lt;/h1&gt;
&lt;p&gt;I often find myself needing to establish the travel time or distance between arrays of addresses. In the past I have used ArcMap’s Network Analyst tool, but have found the syntax to be clunky at best, and the performance to be very mediocre. And, besides, I am often working in R and sometimes it’s nice to be able to do everything in the one environment, rather than doing the routing in Python, say, and then using the results in R.&lt;/p&gt;
&lt;p&gt;The &lt;a href=&#34;http://project-osrm.org/&#34;&gt;open source routing machine&lt;/a&gt; is a very fast routing engine which can be accessed via an &lt;a href=&#34;https://github.com/Project-OSRM/osrm-backend/blob/master/docs/http.md&#34;&gt;HTTP API&lt;/a&gt;, which means it can be queried relatviely easy from most languages, including R. And while public servers are available for use, it is also relatively easy to set up locally resulting in excellent throughput due to the lack of latency.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;prerequisites&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Prerequisites&lt;/h1&gt;
&lt;p&gt;The following R pacakges are required:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;rjson&lt;/code&gt; for reading web service results in JSON format&lt;/li&gt;
&lt;li&gt;&lt;code&gt;bitops&lt;/code&gt; used to decode polylines (has convenient bitshift operators, etc.)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sp&lt;/code&gt; for spatial projections, etc.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;leaflet&lt;/code&gt; for rendering &lt;a href=&#34;http://leafletjs.com/&#34;&gt;leaflet&lt;/a&gt; maps in a browser&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div id=&#34;geocoding-addresses&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Geocoding addresses&lt;/h1&gt;
&lt;p&gt;The &lt;a href=&#34;https://developers.google.com/maps/documentation/geocoding/&#34;&gt;Google Geocoding API&lt;/a&gt; is used to geocode addresses. Usage is free, but the free license is limited to 2500 requests per day, at a rate no faster than 5 per second. There are free alternatives, but I’ve not found any that are satisfactorally accurate for New Zealand addresses. That said, interesting alternatives worth keeping an eye on are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.datasciencetoolkit.org/&#34;&gt;data science toolkit&lt;/a&gt; - doesn’t work at all for New Zealand&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://wiki.openstreetmap.org/wiki/Nominatim&#34;&gt;Nominatim&lt;/a&gt; - finds addresses but probably only okay if approximate locations are acceptable.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The following code results in two addresses being geocoded which we will use as an origin and a destination later when using a routing service.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(rjson)

#use google maps API to geocode a start point...
geoservice &amp;lt;- &amp;quot;http://maps.googleapis.com/maps/api/geocode&amp;quot;
(address &amp;lt;- paste0(geoservice, &amp;quot;/json?sensor=false&amp;amp;&amp;quot;,
   &amp;quot;address=10+Aragon+Grove,+Kingsley+Heights,+Upper+Hutt&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[1] &amp;quot;http://maps.googleapis.com/maps/api/geocode/json?sensor=false&amp;amp;address=10+Aragon+Grove,+Kingsley+Heights,+Upper+Hutt&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;origin &amp;lt;- fromJSON(file=address)

#...and an end point
(address &amp;lt;- paste0(geoservice, &amp;quot;/json?sensor=false&amp;amp;&amp;quot;,
   &amp;quot;address=1+Pipitea+Street,+Wellington&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[1] &amp;quot;http://maps.googleapis.com/maps/api/geocode/json?sensor=false&amp;amp;address=1+Pipitea+Street,+Wellington&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;destination &amp;lt;- fromJSON(file=address)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The &lt;code&gt;fromJSON&lt;/code&gt; function turns a JSON object to an R list. If geocoding is successful (and we will just assume it was) then the origin and destination objects will contain a number of elements. We’re particularly interested in latitude, longitude, and the formatted address. E.g.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;origin$results[[1]]$geometry$location$lat&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[1] -41.12501&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;origin$results[[1]]$geometry$location$lng&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[1] 175.0845&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;origin$results[[1]]$formatted_address&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[1] &amp;quot;10 Aragon Grove, Kingsley Heights, Upper Hutt 5018, New Zealand&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;open-source-routing-machine-osrm&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Open Source Routing Machine (OSRM)&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;http://project-osrm.org/&#34;&gt;Open Source Routing Machine&lt;/a&gt; is an open source route solver. It is written in C++ and runs on Linux (maybe other platforms, but stick with Linux), and is very fast. There is a nice web demo which uses the service as a back-end &lt;a href=&#34;http://map.project-osrm.org/&#34;&gt;here&lt;/a&gt;. The back-end service is available to the public at &lt;a href=&#34;https://router.project-osrm.org&#34; class=&#34;uri&#34;&gt;https://router.project-osrm.org&lt;/a&gt;. Details, including usage policy, is available &lt;a href=&#34;https://github.com/Project-OSRM/osrm-backend/wiki/API Usage Policy&#34;&gt; here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The code below shows how to find a route between the origin and destination locations found above:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;o &amp;lt;- origin$results[[1]]$geometry$location
d &amp;lt;- destination$results[[1]]$geometry$location
(url &amp;lt;- paste0(&amp;quot;http://router.project-osrm.org/route/v1/driving/&amp;quot;, 
   o$lng,&amp;quot;,&amp;quot;,o$lat,&amp;quot;;&amp;quot;,d$lng,&amp;quot;,&amp;quot;,d$lat,&amp;quot;?overview=full&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[1] &amp;quot;http://router.project-osrm.org/route/v1/driving/175.0845498,-41.1250097;174.7811653,-41.2756572?overview=full&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;system.time({
   route &amp;lt;- fromJSON(file=url)
})&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;   user  system elapsed 
  0.000   0.004   1.240 &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Again, assuming a route was successfully found, &lt;code&gt;route&lt;/code&gt; will now contain a list including, among other things, time in seconds to traverse the route, distance in metres, and the route geomertry stored in &lt;a href=&#34;https://developers.google.com/maps/documentation/utilities/polylinealgorithm&#34;&gt;encoded polyline algorithm format&lt;/a&gt;.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;route$routes[[1]]$duration&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[1] 1755.3&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;route$routes[[1]]$distance&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[1] 34283.6&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;route$routes[[1]]$geometry&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[1] &amp;quot;hf_zFufsk`@M?O@QEqAKA\\GVKTKTORQTqB|BKNIRINK`@CXCV@\\@x@p@hEL`@NZPVXLVJl@DdB\\^PVLRRRZFRH`@BZC`@GZIX}@|AY^]TWJm@Li@DeBgFUSYCi@F_Dh@MB]RKJWc@MUmAmB{C_Fm@v@OFaHlAaNxA[eG_BLw@JYNUFBf@NdCFhCFhAP~EJ~CLnCDt@DjAHrBJtBBfAB~@@hA@bBAxACvAIbFAfA?`AD`A@t@HdEHjCNvCFhBD`BDzCBnA?XBlA@z@?hA@zAC|BOrGCxGAjD?|E?pAAdLB~DDfDN~CPvCPtBRlBZbC\\~BBRlBfI\\hAV~@L^l@hBt@lBjAhCr@vAn@jA`AdBdAbB`BfC|BlDpCdEdBnCz@nA^t@Rp@Hb@Hh@Dj@Bt@?r@I~@IbAIlAErABjAJrANt@d@jAVh@Zj@`AbBjAdChAbDz@|Cv@jCtD|NZ`ANd@\\dA~@~B`@`An@vAhAlB`AbB|A|BxDdG~CbFfCxD~BfDdBjCjBxCdAfBdArB~@hB~@`CZv@p@jBb@vA\\hAz@tC|@tCr@pBh@zAx@xBv@jBfAdCpAnCdAvBv@|Ap@rAbB|Cr@vAp@|Ad@hAhAzCt@tBfA`Dj@zAd@dAr@dB|@nBhA|Bp@hA~@zAfBlC`ClDhB~Bt@fAl@|@f@`Ad@x@Zv@Vl@b@pAXdAX`Af@fBb@~Al@|Bj@lCt@jDb@hB`A~Cx@hChBfF^jAb@fAh@nAp@rAt@pA^n@~@lAhAvAhCbDtAnApFzDjDdC~BbC~A|BtCjFbD~FpEhIx@~AzAlCrApCv@bBbAdC|B~HfD`KhBnDb@|@rCjEbE`FjCdCbDtCzCtDnDtFzBxDfD~E~B~ChExF|EnGbCpDpCpF~BrEtBrDdDhEvCfDrClDfCzDvC~FrB~DtBfDxEdGfBlBnBhB`C~BdC|B~ClDtBfCfCfE|ArCtBdEbBtCv@|ApBnE|AnDlDfIxDvIrA~C`ApBfB`DnBtDt@pAtA|Bf@z@FLFNb@z@lA~Bj@rAv@fBx@|ApAdCp@rAzBfEvBpEvB|EpCxFhBdEdAfCnC`HxBhFz@lBhAzBlAhCjAnBh@pAf@rAzAvD~@xBbAxBbBjDnCzFnDnHn@tATj@nArC|@dCn@dBN^Z|@n@hBnAfDnDjJpAjD`@bA^t@vBnDp@rAt@zA|AdDbA~Bz@xBr@dBfAbCd@pAlCjHvBzFv@~Bj@pAr@nAfAlBr@fA`ApAjAnB~BnDv@vAbCpDxA~Bn@dAdAxBp@rARf@^|@j@~Aj@vAf@zAZfATv@ZfA\\|@f@xA^z@\\`A`A`Cn@fB^dAX|@ZfAz@xChApEjB|Gt@pCx@lCfCjHt@nBb@fAl@~AfA`Dl@hBbA`DxBvIvApG|ApHfAnFTpBJnBFfC?bB?`@Ch@El@OhAEf@ARA^?\\B\\Hd@Jd@pBtHxAzGvAjG~AxHbA`EvAbDz@nCvA`IvBxMtAlI\\dBV~@^fAl@tAp@fAt@~@|@x@nCbCf@f@`@h@r@pAb@fAd@~A~@lE\\~A\\fAf@hAh@`A~@rA`GvGlCrDlCtExG~M~IfR|ExHbElIfFxKrBjElBjE`AnBpArCx@bBjAtBjAnBlBhCfBdC~@rAr@bAp@fAj@~@x@zAn@hAn@fAbAnB`AfB`BfDtA~C~BhF|CrGt@`Bn@fAf@t@`@h@j@p@f@j@x@`Aj@l@tAbBfBbCvB~ExA`Er@jCdAzFfAbG~@jDlChI\\lAj@hBp@|Ax@hBlAbCpArBvAnBhAnAx@x@lAdAbA|@jAfAp@n@`@b@b@n@`@p@^r@b@hAb@lAr@jB`@dAd@dAl@hAx@dA~@~@lG|FpAnAhI`Jt@x@~CbDxJvIlAxA`@p@dGhJh@p@TPZLVFV@ZCp@Ox@ULGhAm@j@YvAs@nAo@BCj@YXMRKTMjAm@HcGAKL@&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We write a function to convert the encoded route to a &lt;code&gt;SpatialLines&lt;/code&gt; object:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;decode &amp;lt;- function(str, multiplier=1e5){
   
   if (!require(bitops)) stop(&amp;quot;Package: bitops required.&amp;quot;)
   if (!require(sp)) stop(&amp;quot;Package: sp required.&amp;quot;)
   
   truck &amp;lt;- 0
   trucks &amp;lt;- c()
   carriage_q &amp;lt;- 0
   
   for (i in 0:(nchar(str)-1)){
      ch &amp;lt;- substr(str, (i+1), (i+1))
      x &amp;lt;- as.numeric(charToRaw(ch)) - 63
      x5 &amp;lt;- bitShiftR(bitShiftL(x, 32-5), 32-5)
      truck &amp;lt;- bitOr(truck, bitShiftL(x5, carriage_q))
      carriage_q &amp;lt;- carriage_q + 5
      islast &amp;lt;- bitAnd(x, 32) == 0
      if (islast){
         negative &amp;lt;- bitAnd(truck, 1) == 1
         if (negative) truck &amp;lt;- -bitShiftR(-bitFlip(truck), 1)/multiplier
         else truck &amp;lt;- bitShiftR(truck, 1)/multiplier
         trucks &amp;lt;- c(trucks, truck)
         carriage_q &amp;lt;- 0
         truck &amp;lt;- 0
      }
   }
   lat &amp;lt;- trucks[c(T,F)][-1]
   lng &amp;lt;- trucks[c(F,T)][-1]
   res &amp;lt;- data.frame(lat=c(trucks[1],cumsum(lat)+trucks[1]), 
                     lng=c(trucks[2],cumsum(lng)+trucks[2]))

   coordinates(res) &amp;lt;- ~lng+lat
   proj4string(res) &amp;lt;- CRS(&amp;quot;+init=epsg:4326&amp;quot;)
   return(SpatialLines(list(Lines(Line(res), 1)), CRS(&amp;quot;+init=epsg:4326&amp;quot;)))
}&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;par(mar=par()$mar-c(1,0,2.5,0), cex=0.8)
path &amp;lt;- decode(route$routes[[1]]$geometry, multiplier=1e5)
plot(path); axis(1); axis(2); box()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;#####../content/post/routing_files/figure-html/plot-1.png&#34; width=&#34;810&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;using-leaflet-to-make-a-nicer-map&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Using &lt;code&gt;leaflet&lt;/code&gt; to make a nicer map&lt;/h1&gt;
&lt;p&gt;It is relatively easy to make a nice interactive map. Here we draw a simple &lt;a href=&#34;http://leafletjs.com/&#34;&gt;leaflet&lt;/a&gt; map, and overlay the origin and destination points, as well as the route between.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;#make a string to nicely label the route
s &amp;lt;- route$routes[[1]]$duration
kms &amp;lt;- round(route$routes[[1]]$distance/1000, 1)
routelabel &amp;lt;- paste0(s%/%60, &amp;quot;m &amp;quot;, s%%60, &amp;quot;s , &amp;quot;, kms, &amp;quot;kms&amp;quot;)

#create a basic map
library(leaflet)
m &amp;lt;- leaflet(width=&amp;quot;100%&amp;quot;) %&amp;gt;% 
  addTiles()  %&amp;gt;% 
  addPolylines(data=path, popup=routelabel, color = &amp;quot;#000000&amp;quot;, opacity=1, weight = 3) %&amp;gt;%
  addMarkers(lng=o$lng, lat=o$lat, popup=origin$results[[1]]$formatted_address) %&amp;gt;%
  addMarkers(lng=d$lng, lat=d$lat, popup=destination$results[[1]]$formatted_address)&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;m&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-68989a44cffaf687f09c&#34; style=&#34;width:100%;height:480px;&#34; class=&#34;leaflet html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-68989a44cffaf687f09c&#34;&gt;{&#34;x&#34;:{&#34;calls&#34;:[{&#34;method&#34;:&#34;addTiles&#34;,&#34;args&#34;:[&#34;http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&#34;,null,null,{&#34;minZoom&#34;:0,&#34;maxZoom&#34;:18,&#34;maxNativeZoom&#34;:null,&#34;tileSize&#34;:256,&#34;subdomains&#34;:&#34;abc&#34;,&#34;errorTileUrl&#34;:&#34;&#34;,&#34;tms&#34;:false,&#34;continuousWorld&#34;:false,&#34;noWrap&#34;:false,&#34;zoomOffset&#34;:0,&#34;zoomReverse&#34;:false,&#34;opacity&#34;:1,&#34;zIndex&#34;:null,&#34;unloadInvisibleTiles&#34;:null,&#34;updateWhenIdle&#34;:null,&#34;detectRetina&#34;:false,&#34;reuseTiles&#34;:false,&#34;attribution&#34;:&#34;&amp;copy; &lt;a href=\&#34;http://openstreetmap.org\&#34;&gt;OpenStreetMap\u003c/a&gt; contributors, &lt;a href=\&#34;http://creativecommons.org/licenses/by-sa/2.0/\&#34;&gt;CC-BY-SA\u003c/a&gt;&#34;}]},{&#34;method&#34;:&#34;addPolylines&#34;,&#34;args&#34;:[[[{&#34;lng&#34;:[175.08475,175.08475,175.08474,175.08477,175.08483,175.08468,175.08456,175.08445,175.08434,175.08424,175.08413,175.0835,175.08342,175.08332,175.08324,175.08307,175.08294,175.08282,175.08267,175.08238,175.08137,175.0812,175.08106,175.08094,175.08087,175.08081,175.08078,175.08063,175.08054,175.08047,175.08037,175.08023,175.08013,175.07996,175.07982,175.07965,175.07951,175.07938,175.07891,175.07875,175.07864,175.07858,175.07851,175.07848,175.07964,175.07974,175.07976,175.07972,175.07951,175.07949,175.07939,175.07933,175.07951,175.07962,175.08017,175.08129,175.08101,175.08097,175.08058,175.08013,175.08144,175.08137,175.08131,175.08123,175.08119,175.08099,175.08032,175.07963,175.07926,175.07814,175.07734,175.07662,175.07635,175.07597,175.07539,175.0748,175.07444,175.07412,175.07375,175.07325,175.0728,175.07236,175.07122,175.07086,175.07053,175.0702,175.06993,175.06894,175.06824,175.06748,175.06695,175.06646,175.06568,175.06528,175.06515,175.06476,175.06446,175.06409,175.06363,175.063,175.06162,175.06021,175.05935,175.05824,175.05783,175.05572,175.05476,175.05392,175.05312,175.05236,175.05177,175.05122,175.05056,175.04992,175.04982,175.04818,175.04781,175.04749,175.04733,175.0468,175.04625,175.04556,175.04512,175.04474,175.04423,175.04373,175.04305,175.04218,175.04119,175.04047,175.04007,175.0398,175.03955,175.03937,175.03916,175.03894,175.03867,175.03841,175.03809,175.03775,175.03736,175.03694,175.03656,175.03614,175.03587,175.03549,175.03528,175.03506,175.03456,175.03389,175.03307,175.03228,175.03158,175.02903,175.0287,175.02851,175.02816,175.02752,175.02719,175.02675,175.0262,175.0257,175.02507,175.02376,175.02262,175.02169,175.02085,175.02015,175.01938,175.01886,175.01828,175.01775,175.0171,175.01682,175.01628,175.01584,175.01547,175.01472,175.01397,175.0134,175.01294,175.01233,175.01179,175.01112,175.0104,175.0098,175.00933,175.00891,175.00812,175.00768,175.00721,175.00684,175.00606,175.00547,175.00466,175.0042,175.00385,175.00334,175.00278,175.00215,175.00178,175.00132,175.00061,174.99974,174.9991,174.99874,174.99843,174.9981,174.99781,174.99753,174.9973,174.99689,174.99654,174.99621,174.99569,174.99521,174.99458,174.99387,174.99301,174.99248,174.99168,174.99099,174.98983,174.98945,174.98909,174.98869,174.98827,174.98786,174.98762,174.98723,174.98679,174.98597,174.98557,174.98463,174.98396,174.9833,174.98267,174.98149,174.98021,174.97856,174.97808,174.97737,174.97664,174.97614,174.97547,174.97387,174.97194,174.97106,174.97075,174.96973,174.9686,174.96793,174.96718,174.96627,174.96504,174.96411,174.96299,174.96219,174.96094,174.95958,174.95869,174.95748,174.95642,174.95552,174.95451,174.95367,174.9528,174.95186,174.95058,174.94962,174.94878,174.94747,174.94692,174.94639,174.94575,174.94512,174.94425,174.94357,174.94257,174.94183,174.94084,174.94009,174.93962,174.93858,174.9377,174.93606,174.93434,174.93354,174.93297,174.93216,174.93125,174.93084,174.93021,174.92991,174.92984,174.92976,174.92946,174.92882,174.9284,174.92788,174.92741,174.92674,174.92632,174.92532,174.92427,174.92316,174.92191,174.92092,174.92024,174.91879,174.91762,174.91707,174.91645,174.91576,174.9152,174.91479,174.91437,174.91345,174.91284,174.91223,174.91137,174.91011,174.90859,174.90816,174.90794,174.9072,174.90653,174.90602,174.90586,174.90555,174.90502,174.90418,174.90236,174.9015,174.90116,174.90089,174.90001,174.89959,174.89913,174.8983,174.89766,174.89705,174.89654,174.89588,174.89547,174.89397,174.89271,174.89207,174.89166,174.89126,174.89071,174.89035,174.88994,174.88938,174.8885,174.88806,174.88717,174.88653,174.88618,174.88557,174.88515,174.88495,174.88464,174.88416,174.88372,174.88326,174.8829,174.88262,174.88226,174.88195,174.8815,174.8812,174.88087,174.88022,174.8797,174.87935,174.87904,174.87868,174.87791,174.87686,174.87543,174.8747,174.87399,174.87249,174.87193,174.87157,174.87109,174.87028,174.86975,174.86894,174.86722,174.86585,174.86432,174.86312,174.86255,174.86199,174.86131,174.86081,174.86064,174.86043,174.8602,174.85983,174.85963,174.85953,174.85937,174.85922,174.85907,174.85888,174.85869,174.85714,174.85572,174.85438,174.85281,174.85184,174.85102,174.8503,174.84869,174.84632,174.84465,174.84414,174.84382,174.84346,174.84303,174.84267,174.84235,174.84206,174.8414,174.8412,174.84099,174.84058,174.84022,174.83974,174.83871,174.83823,174.83787,174.8375,174.83717,174.83675,174.83535,174.83445,174.83338,174.83098,174.8279,174.82633,174.82466,174.82261,174.82159,174.82057,174.82001,174.81927,174.81877,174.81818,174.81762,174.81693,174.81626,174.81584,174.8155,174.81514,174.81482,174.81436,174.81399,174.81363,174.81307,174.81255,174.81171,174.81091,174.80974,174.80836,174.80787,174.80751,174.80724,174.80703,174.80678,174.80656,174.80623,174.806,174.8055,174.80484,174.80372,174.80275,174.80205,174.80079,174.79949,174.79863,174.79698,174.79659,174.79606,174.79559,174.79506,174.7944,174.79382,174.79326,174.79286,174.79257,174.79222,174.79191,174.79155,174.79131,174.79113,174.79089,174.79064,174.79038,174.79001,174.78962,174.78908,174.78873,174.78838,174.78801,174.78766,174.78734,174.78607,174.78567,174.7839,174.78361,174.78279,174.78107,174.78062,174.78037,174.77856,174.77831,174.77822,174.77815,174.77811,174.7781,174.77812,174.7782,174.77831,174.77835,174.77858,174.77871,174.77897,174.77921,174.77923,174.77936,174.77943,174.77949,174.77956,174.77979,174.78109,174.78115,174.78114],&#34;lat&#34;:[-41.12501,-41.12494,-41.12486,-41.12477,-41.12436,-41.12435,-41.12431,-41.12425,-41.12419,-41.12411,-41.12402,-41.12345,-41.12339,-41.12334,-41.12329,-41.12323,-41.12321,-41.12319,-41.1232,-41.12321,-41.12346,-41.12353,-41.12361,-41.1237,-41.12383,-41.12395,-41.12418,-41.12469,-41.12485,-41.12497,-41.12507,-41.12517,-41.12521,-41.12526,-41.12528,-41.12526,-41.12522,-41.12517,-41.12486,-41.12473,-41.12458,-41.12446,-41.12423,-41.12402,-41.12351,-41.1234,-41.12327,-41.12306,-41.12226,-41.12219,-41.12204,-41.12198,-41.12186,-41.12179,-41.1214,-41.12062,-41.12039,-41.12031,-41.11886,-41.11645,-41.11631,-41.11583,-41.11555,-41.11542,-41.11531,-41.11533,-41.11541,-41.11545,-41.11549,-41.11558,-41.11564,-41.11571,-41.11574,-41.11577,-41.11582,-41.11588,-41.1159,-41.11592,-41.11593,-41.11594,-41.11593,-41.11591,-41.11586,-41.11585,-41.11585,-41.11588,-41.11589,-41.11594,-41.11599,-41.11607,-41.11611,-41.11614,-41.11617,-41.11619,-41.11619,-41.11621,-41.11622,-41.11622,-41.11623,-41.11621,-41.11613,-41.11611,-41.1161,-41.1161,-41.1161,-41.11609,-41.11611,-41.11614,-41.11622,-41.11631,-41.1164,-41.1165,-41.11664,-41.11679,-41.11681,-41.11736,-41.11751,-41.11763,-41.1177,-41.11793,-41.1182,-41.11858,-41.11884,-41.11908,-41.11941,-41.11976,-41.12025,-41.12088,-41.12161,-41.12212,-41.12242,-41.12258,-41.12268,-41.12273,-41.12278,-41.12281,-41.12283,-41.12283,-41.12278,-41.12273,-41.12268,-41.12265,-41.12267,-41.12273,-41.12281,-41.123,-41.12312,-41.12326,-41.12359,-41.12397,-41.12434,-41.12464,-41.12492,-41.12583,-41.12597,-41.12605,-41.1262,-41.12652,-41.12669,-41.12693,-41.1273,-41.12763,-41.1281,-41.12903,-41.12983,-41.13051,-41.13115,-41.13166,-41.1322,-41.13255,-41.1329,-41.13322,-41.13354,-41.13368,-41.13393,-41.13411,-41.13426,-41.13456,-41.13487,-41.13513,-41.13534,-41.13563,-41.13591,-41.13627,-41.13668,-41.13703,-41.13731,-41.13756,-41.13806,-41.13832,-41.13857,-41.13876,-41.13913,-41.1394,-41.13976,-41.13998,-41.14017,-41.14043,-41.14074,-41.14111,-41.14136,-41.14168,-41.1422,-41.14285,-41.14338,-41.14365,-41.14388,-41.14408,-41.14427,-41.14441,-41.14453,-41.14471,-41.14484,-41.14497,-41.14517,-41.14535,-41.14558,-41.1458,-41.14607,-41.14625,-41.14658,-41.14687,-41.1474,-41.14756,-41.14774,-41.14795,-41.1482,-41.14847,-41.14863,-41.14895,-41.14932,-41.15001,-41.15044,-41.15165,-41.15251,-41.15315,-41.15363,-41.15438,-41.1552,-41.15625,-41.15654,-41.157,-41.15742,-41.1577,-41.15804,-41.15867,-41.15951,-41.16004,-41.16022,-41.16096,-41.16194,-41.16264,-41.16346,-41.16424,-41.16512,-41.16574,-41.16658,-41.16722,-41.16823,-41.16934,-41.17,-41.17073,-41.17137,-41.17196,-41.17279,-41.17355,-41.17429,-41.17497,-41.17573,-41.17631,-41.1769,-41.17799,-41.17851,-41.17907,-41.17972,-41.18039,-41.18119,-41.18178,-41.18246,-41.18293,-41.18352,-41.18402,-41.1843,-41.18487,-41.18534,-41.18621,-41.18714,-41.18756,-41.18789,-41.18841,-41.18897,-41.18924,-41.18967,-41.18987,-41.18991,-41.18995,-41.19013,-41.19052,-41.19074,-41.19102,-41.19131,-41.19172,-41.19197,-41.19259,-41.19319,-41.19379,-41.19452,-41.19505,-41.1954,-41.19612,-41.19673,-41.19703,-41.1974,-41.19779,-41.19817,-41.19838,-41.19858,-41.19904,-41.19936,-41.1997,-41.2002,-41.20092,-41.2018,-41.20204,-41.20215,-41.20255,-41.20286,-41.2031,-41.20318,-41.20332,-41.20356,-41.20396,-41.20484,-41.20525,-41.20542,-41.20558,-41.20618,-41.20643,-41.2067,-41.20717,-41.20751,-41.20781,-41.20807,-41.20843,-41.20862,-41.20933,-41.20993,-41.21021,-41.21043,-41.21069,-41.21105,-41.21131,-41.21164,-41.21202,-41.21266,-41.21294,-41.2136,-41.21405,-41.21429,-41.21464,-41.21489,-41.21499,-41.21515,-41.21537,-41.21559,-41.21579,-41.21593,-41.21604,-41.21618,-41.21633,-41.21653,-41.21669,-41.21684,-41.21717,-41.21741,-41.21757,-41.2177,-41.21784,-41.21814,-41.21851,-41.21905,-41.21932,-41.21961,-41.22029,-41.22056,-41.22074,-41.22097,-41.22133,-41.22156,-41.2219,-41.22251,-41.22295,-41.22342,-41.22378,-41.22389,-41.22395,-41.22399,-41.22399,-41.22399,-41.22397,-41.22394,-41.22386,-41.22383,-41.22382,-41.22381,-41.22381,-41.22383,-41.22388,-41.22394,-41.22451,-41.22496,-41.2254,-41.22588,-41.22622,-41.22666,-41.22696,-41.2274,-41.228,-41.22843,-41.22858,-41.2287,-41.22886,-41.22909,-41.22934,-41.22961,-41.22992,-41.23064,-41.23084,-41.23101,-41.23127,-41.23145,-41.23164,-41.23196,-41.23211,-41.23226,-41.23246,-41.23267,-41.23299,-41.23428,-41.23499,-41.2357,-41.23711,-41.23887,-41.23998,-41.24096,-41.24212,-41.2427,-41.24325,-41.24358,-41.24399,-41.24428,-41.24466,-41.24504,-41.24559,-41.24611,-41.24643,-41.24669,-41.24694,-41.24716,-41.24745,-41.24769,-41.24793,-41.24827,-41.2486,-41.24909,-41.24952,-41.25016,-41.25095,-41.25122,-41.25146,-41.25166,-41.25183,-41.25205,-41.25225,-41.25254,-41.25276,-41.25319,-41.25371,-41.25431,-41.25476,-41.25502,-41.25537,-41.25573,-41.25605,-41.25676,-41.25691,-41.25713,-41.25738,-41.25767,-41.25806,-41.25847,-41.25891,-41.25928,-41.25957,-41.25996,-41.2603,-41.26068,-41.26093,-41.2611,-41.26128,-41.26145,-41.26161,-41.26179,-41.26197,-41.26223,-41.2624,-41.26259,-41.26282,-41.26311,-41.26343,-41.26478,-41.26519,-41.26684,-41.26711,-41.26791,-41.2698,-41.27019,-41.27036,-41.27167,-41.27188,-41.27199,-41.27213,-41.27225,-41.27237,-41.27251,-41.27276,-41.27305,-41.27312,-41.27349,-41.27371,-41.27415,-41.27455,-41.27457,-41.27479,-41.27492,-41.27502,-41.27513,-41.27551,-41.27556,-41.27555,-41.27562]}]],null,null,{&#34;lineCap&#34;:null,&#34;lineJoin&#34;:null,&#34;clickable&#34;:true,&#34;pointerEvents&#34;:null,&#34;className&#34;:&#34;&#34;,&#34;stroke&#34;:true,&#34;color&#34;:&#34;#000000&#34;,&#34;weight&#34;:3,&#34;opacity&#34;:1,&#34;fill&#34;:false,&#34;fillColor&#34;:&#34;#000000&#34;,&#34;fillOpacity&#34;:0.2,&#34;dashArray&#34;:null,&#34;smoothFactor&#34;:1,&#34;noClip&#34;:false},&#34;29m 15.3s , 34.3kms&#34;,null,null]},{&#34;method&#34;:&#34;addMarkers&#34;,&#34;args&#34;:[-41.1250097,175.0845498,null,null,null,{&#34;clickable&#34;:true,&#34;draggable&#34;:false,&#34;keyboard&#34;:true,&#34;title&#34;:&#34;&#34;,&#34;alt&#34;:&#34;&#34;,&#34;zIndexOffset&#34;:0,&#34;opacity&#34;:1,&#34;riseOnHover&#34;:false,&#34;riseOffset&#34;:250},&#34;10 Aragon Grove, Kingsley Heights, Upper Hutt 5018, New Zealand&#34;,null,null,null,null]},{&#34;method&#34;:&#34;addMarkers&#34;,&#34;args&#34;:[-41.2756572,174.7811653,null,null,null,{&#34;clickable&#34;:true,&#34;draggable&#34;:false,&#34;keyboard&#34;:true,&#34;title&#34;:&#34;&#34;,&#34;alt&#34;:&#34;&#34;,&#34;zIndexOffset&#34;:0,&#34;opacity&#34;:1,&#34;riseOnHover&#34;:false,&#34;riseOffset&#34;:250},&#34;1 Pipitea St, Pipitea, Wellington 6011, New Zealand&#34;,null,null,null,null]}],&#34;limits&#34;:{&#34;lat&#34;:[-41.2756572,-41.11531],&#34;lng&#34;:[174.7781,175.08483]}},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;It’s also relatively straight forward to use different base maps, and a nice demo of some other providers can be found &lt;a href=&#34;http://leaflet-extras.github.io/leaflet-providers/preview/&#34;&gt;here&lt;/a&gt;. For example:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;require(leaflet)
leaflet(width=&amp;quot;100%&amp;quot;, height=600) %&amp;gt;% 
  addTiles(urlTemplate=&amp;#39;http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.png&amp;#39;) %&amp;gt;%
  addTiles(urlTemplate=&amp;#39;http://{s}.tile.openstreetmap.se/hydda/roads_and_labels/{z}/{x}/{y}.png&amp;#39;) %&amp;gt;%
  addPolylines(data=path, popup=routelabel, color = &amp;quot;#000000&amp;quot;, opacity=1, weight = 3) %&amp;gt;%
  addMarkers(lng=o$lng, lat=o$lat, popup=origin$results[[1]]$formatted_address) %&amp;gt;%
  addMarkers(lng=d$lng, lat=d$lat, popup=destination$results[[1]]$formatted_address)&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-4cf2432c4149c99c6041&#34; style=&#34;width:100%;height:600px;&#34; class=&#34;leaflet html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-4cf2432c4149c99c6041&#34;&gt;{&#34;x&#34;:{&#34;calls&#34;:[{&#34;method&#34;:&#34;addTiles&#34;,&#34;args&#34;:[&#34;http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.png&#34;,null,null,{&#34;minZoom&#34;:0,&#34;maxZoom&#34;:18,&#34;maxNativeZoom&#34;:null,&#34;tileSize&#34;:256,&#34;subdomains&#34;:&#34;abc&#34;,&#34;errorTileUrl&#34;:&#34;&#34;,&#34;tms&#34;:false,&#34;continuousWorld&#34;:false,&#34;noWrap&#34;:false,&#34;zoomOffset&#34;:0,&#34;zoomReverse&#34;:false,&#34;opacity&#34;:1,&#34;zIndex&#34;:null,&#34;unloadInvisibleTiles&#34;:null,&#34;updateWhenIdle&#34;:null,&#34;detectRetina&#34;:false,&#34;reuseTiles&#34;:false}]},{&#34;method&#34;:&#34;addTiles&#34;,&#34;args&#34;:[&#34;http://{s}.tile.openstreetmap.se/hydda/roads_and_labels/{z}/{x}/{y}.png&#34;,null,null,{&#34;minZoom&#34;:0,&#34;maxZoom&#34;:18,&#34;maxNativeZoom&#34;:null,&#34;tileSize&#34;:256,&#34;subdomains&#34;:&#34;abc&#34;,&#34;errorTileUrl&#34;:&#34;&#34;,&#34;tms&#34;:false,&#34;continuousWorld&#34;:false,&#34;noWrap&#34;:false,&#34;zoomOffset&#34;:0,&#34;zoomReverse&#34;:false,&#34;opacity&#34;:1,&#34;zIndex&#34;:null,&#34;unloadInvisibleTiles&#34;:null,&#34;updateWhenIdle&#34;:null,&#34;detectRetina&#34;:false,&#34;reuseTiles&#34;:false}]},{&#34;method&#34;:&#34;addPolylines&#34;,&#34;args&#34;:[[[{&#34;lng&#34;:[175.08475,175.08475,175.08474,175.08477,175.08483,175.08468,175.08456,175.08445,175.08434,175.08424,175.08413,175.0835,175.08342,175.08332,175.08324,175.08307,175.08294,175.08282,175.08267,175.08238,175.08137,175.0812,175.08106,175.08094,175.08087,175.08081,175.08078,175.08063,175.08054,175.08047,175.08037,175.08023,175.08013,175.07996,175.07982,175.07965,175.07951,175.07938,175.07891,175.07875,175.07864,175.07858,175.07851,175.07848,175.07964,175.07974,175.07976,175.07972,175.07951,175.07949,175.07939,175.07933,175.07951,175.07962,175.08017,175.08129,175.08101,175.08097,175.08058,175.08013,175.08144,175.08137,175.08131,175.08123,175.08119,175.08099,175.08032,175.07963,175.07926,175.07814,175.07734,175.07662,175.07635,175.07597,175.07539,175.0748,175.07444,175.07412,175.07375,175.07325,175.0728,175.07236,175.07122,175.07086,175.07053,175.0702,175.06993,175.06894,175.06824,175.06748,175.06695,175.06646,175.06568,175.06528,175.06515,175.06476,175.06446,175.06409,175.06363,175.063,175.06162,175.06021,175.05935,175.05824,175.05783,175.05572,175.05476,175.05392,175.05312,175.05236,175.05177,175.05122,175.05056,175.04992,175.04982,175.04818,175.04781,175.04749,175.04733,175.0468,175.04625,175.04556,175.04512,175.04474,175.04423,175.04373,175.04305,175.04218,175.04119,175.04047,175.04007,175.0398,175.03955,175.03937,175.03916,175.03894,175.03867,175.03841,175.03809,175.03775,175.03736,175.03694,175.03656,175.03614,175.03587,175.03549,175.03528,175.03506,175.03456,175.03389,175.03307,175.03228,175.03158,175.02903,175.0287,175.02851,175.02816,175.02752,175.02719,175.02675,175.0262,175.0257,175.02507,175.02376,175.02262,175.02169,175.02085,175.02015,175.01938,175.01886,175.01828,175.01775,175.0171,175.01682,175.01628,175.01584,175.01547,175.01472,175.01397,175.0134,175.01294,175.01233,175.01179,175.01112,175.0104,175.0098,175.00933,175.00891,175.00812,175.00768,175.00721,175.00684,175.00606,175.00547,175.00466,175.0042,175.00385,175.00334,175.00278,175.00215,175.00178,175.00132,175.00061,174.99974,174.9991,174.99874,174.99843,174.9981,174.99781,174.99753,174.9973,174.99689,174.99654,174.99621,174.99569,174.99521,174.99458,174.99387,174.99301,174.99248,174.99168,174.99099,174.98983,174.98945,174.98909,174.98869,174.98827,174.98786,174.98762,174.98723,174.98679,174.98597,174.98557,174.98463,174.98396,174.9833,174.98267,174.98149,174.98021,174.97856,174.97808,174.97737,174.97664,174.97614,174.97547,174.97387,174.97194,174.97106,174.97075,174.96973,174.9686,174.96793,174.96718,174.96627,174.96504,174.96411,174.96299,174.96219,174.96094,174.95958,174.95869,174.95748,174.95642,174.95552,174.95451,174.95367,174.9528,174.95186,174.95058,174.94962,174.94878,174.94747,174.94692,174.94639,174.94575,174.94512,174.94425,174.94357,174.94257,174.94183,174.94084,174.94009,174.93962,174.93858,174.9377,174.93606,174.93434,174.93354,174.93297,174.93216,174.93125,174.93084,174.93021,174.92991,174.92984,174.92976,174.92946,174.92882,174.9284,174.92788,174.92741,174.92674,174.92632,174.92532,174.92427,174.92316,174.92191,174.92092,174.92024,174.91879,174.91762,174.91707,174.91645,174.91576,174.9152,174.91479,174.91437,174.91345,174.91284,174.91223,174.91137,174.91011,174.90859,174.90816,174.90794,174.9072,174.90653,174.90602,174.90586,174.90555,174.90502,174.90418,174.90236,174.9015,174.90116,174.90089,174.90001,174.89959,174.89913,174.8983,174.89766,174.89705,174.89654,174.89588,174.89547,174.89397,174.89271,174.89207,174.89166,174.89126,174.89071,174.89035,174.88994,174.88938,174.8885,174.88806,174.88717,174.88653,174.88618,174.88557,174.88515,174.88495,174.88464,174.88416,174.88372,174.88326,174.8829,174.88262,174.88226,174.88195,174.8815,174.8812,174.88087,174.88022,174.8797,174.87935,174.87904,174.87868,174.87791,174.87686,174.87543,174.8747,174.87399,174.87249,174.87193,174.87157,174.87109,174.87028,174.86975,174.86894,174.86722,174.86585,174.86432,174.86312,174.86255,174.86199,174.86131,174.86081,174.86064,174.86043,174.8602,174.85983,174.85963,174.85953,174.85937,174.85922,174.85907,174.85888,174.85869,174.85714,174.85572,174.85438,174.85281,174.85184,174.85102,174.8503,174.84869,174.84632,174.84465,174.84414,174.84382,174.84346,174.84303,174.84267,174.84235,174.84206,174.8414,174.8412,174.84099,174.84058,174.84022,174.83974,174.83871,174.83823,174.83787,174.8375,174.83717,174.83675,174.83535,174.83445,174.83338,174.83098,174.8279,174.82633,174.82466,174.82261,174.82159,174.82057,174.82001,174.81927,174.81877,174.81818,174.81762,174.81693,174.81626,174.81584,174.8155,174.81514,174.81482,174.81436,174.81399,174.81363,174.81307,174.81255,174.81171,174.81091,174.80974,174.80836,174.80787,174.80751,174.80724,174.80703,174.80678,174.80656,174.80623,174.806,174.8055,174.80484,174.80372,174.80275,174.80205,174.80079,174.79949,174.79863,174.79698,174.79659,174.79606,174.79559,174.79506,174.7944,174.79382,174.79326,174.79286,174.79257,174.79222,174.79191,174.79155,174.79131,174.79113,174.79089,174.79064,174.79038,174.79001,174.78962,174.78908,174.78873,174.78838,174.78801,174.78766,174.78734,174.78607,174.78567,174.7839,174.78361,174.78279,174.78107,174.78062,174.78037,174.77856,174.77831,174.77822,174.77815,174.77811,174.7781,174.77812,174.7782,174.77831,174.77835,174.77858,174.77871,174.77897,174.77921,174.77923,174.77936,174.77943,174.77949,174.77956,174.77979,174.78109,174.78115,174.78114],&#34;lat&#34;:[-41.12501,-41.12494,-41.12486,-41.12477,-41.12436,-41.12435,-41.12431,-41.12425,-41.12419,-41.12411,-41.12402,-41.12345,-41.12339,-41.12334,-41.12329,-41.12323,-41.12321,-41.12319,-41.1232,-41.12321,-41.12346,-41.12353,-41.12361,-41.1237,-41.12383,-41.12395,-41.12418,-41.12469,-41.12485,-41.12497,-41.12507,-41.12517,-41.12521,-41.12526,-41.12528,-41.12526,-41.12522,-41.12517,-41.12486,-41.12473,-41.12458,-41.12446,-41.12423,-41.12402,-41.12351,-41.1234,-41.12327,-41.12306,-41.12226,-41.12219,-41.12204,-41.12198,-41.12186,-41.12179,-41.1214,-41.12062,-41.12039,-41.12031,-41.11886,-41.11645,-41.11631,-41.11583,-41.11555,-41.11542,-41.11531,-41.11533,-41.11541,-41.11545,-41.11549,-41.11558,-41.11564,-41.11571,-41.11574,-41.11577,-41.11582,-41.11588,-41.1159,-41.11592,-41.11593,-41.11594,-41.11593,-41.11591,-41.11586,-41.11585,-41.11585,-41.11588,-41.11589,-41.11594,-41.11599,-41.11607,-41.11611,-41.11614,-41.11617,-41.11619,-41.11619,-41.11621,-41.11622,-41.11622,-41.11623,-41.11621,-41.11613,-41.11611,-41.1161,-41.1161,-41.1161,-41.11609,-41.11611,-41.11614,-41.11622,-41.11631,-41.1164,-41.1165,-41.11664,-41.11679,-41.11681,-41.11736,-41.11751,-41.11763,-41.1177,-41.11793,-41.1182,-41.11858,-41.11884,-41.11908,-41.11941,-41.11976,-41.12025,-41.12088,-41.12161,-41.12212,-41.12242,-41.12258,-41.12268,-41.12273,-41.12278,-41.12281,-41.12283,-41.12283,-41.12278,-41.12273,-41.12268,-41.12265,-41.12267,-41.12273,-41.12281,-41.123,-41.12312,-41.12326,-41.12359,-41.12397,-41.12434,-41.12464,-41.12492,-41.12583,-41.12597,-41.12605,-41.1262,-41.12652,-41.12669,-41.12693,-41.1273,-41.12763,-41.1281,-41.12903,-41.12983,-41.13051,-41.13115,-41.13166,-41.1322,-41.13255,-41.1329,-41.13322,-41.13354,-41.13368,-41.13393,-41.13411,-41.13426,-41.13456,-41.13487,-41.13513,-41.13534,-41.13563,-41.13591,-41.13627,-41.13668,-41.13703,-41.13731,-41.13756,-41.13806,-41.13832,-41.13857,-41.13876,-41.13913,-41.1394,-41.13976,-41.13998,-41.14017,-41.14043,-41.14074,-41.14111,-41.14136,-41.14168,-41.1422,-41.14285,-41.14338,-41.14365,-41.14388,-41.14408,-41.14427,-41.14441,-41.14453,-41.14471,-41.14484,-41.14497,-41.14517,-41.14535,-41.14558,-41.1458,-41.14607,-41.14625,-41.14658,-41.14687,-41.1474,-41.14756,-41.14774,-41.14795,-41.1482,-41.14847,-41.14863,-41.14895,-41.14932,-41.15001,-41.15044,-41.15165,-41.15251,-41.15315,-41.15363,-41.15438,-41.1552,-41.15625,-41.15654,-41.157,-41.15742,-41.1577,-41.15804,-41.15867,-41.15951,-41.16004,-41.16022,-41.16096,-41.16194,-41.16264,-41.16346,-41.16424,-41.16512,-41.16574,-41.16658,-41.16722,-41.16823,-41.16934,-41.17,-41.17073,-41.17137,-41.17196,-41.17279,-41.17355,-41.17429,-41.17497,-41.17573,-41.17631,-41.1769,-41.17799,-41.17851,-41.17907,-41.17972,-41.18039,-41.18119,-41.18178,-41.18246,-41.18293,-41.18352,-41.18402,-41.1843,-41.18487,-41.18534,-41.18621,-41.18714,-41.18756,-41.18789,-41.18841,-41.18897,-41.18924,-41.18967,-41.18987,-41.18991,-41.18995,-41.19013,-41.19052,-41.19074,-41.19102,-41.19131,-41.19172,-41.19197,-41.19259,-41.19319,-41.19379,-41.19452,-41.19505,-41.1954,-41.19612,-41.19673,-41.19703,-41.1974,-41.19779,-41.19817,-41.19838,-41.19858,-41.19904,-41.19936,-41.1997,-41.2002,-41.20092,-41.2018,-41.20204,-41.20215,-41.20255,-41.20286,-41.2031,-41.20318,-41.20332,-41.20356,-41.20396,-41.20484,-41.20525,-41.20542,-41.20558,-41.20618,-41.20643,-41.2067,-41.20717,-41.20751,-41.20781,-41.20807,-41.20843,-41.20862,-41.20933,-41.20993,-41.21021,-41.21043,-41.21069,-41.21105,-41.21131,-41.21164,-41.21202,-41.21266,-41.21294,-41.2136,-41.21405,-41.21429,-41.21464,-41.21489,-41.21499,-41.21515,-41.21537,-41.21559,-41.21579,-41.21593,-41.21604,-41.21618,-41.21633,-41.21653,-41.21669,-41.21684,-41.21717,-41.21741,-41.21757,-41.2177,-41.21784,-41.21814,-41.21851,-41.21905,-41.21932,-41.21961,-41.22029,-41.22056,-41.22074,-41.22097,-41.22133,-41.22156,-41.2219,-41.22251,-41.22295,-41.22342,-41.22378,-41.22389,-41.22395,-41.22399,-41.22399,-41.22399,-41.22397,-41.22394,-41.22386,-41.22383,-41.22382,-41.22381,-41.22381,-41.22383,-41.22388,-41.22394,-41.22451,-41.22496,-41.2254,-41.22588,-41.22622,-41.22666,-41.22696,-41.2274,-41.228,-41.22843,-41.22858,-41.2287,-41.22886,-41.22909,-41.22934,-41.22961,-41.22992,-41.23064,-41.23084,-41.23101,-41.23127,-41.23145,-41.23164,-41.23196,-41.23211,-41.23226,-41.23246,-41.23267,-41.23299,-41.23428,-41.23499,-41.2357,-41.23711,-41.23887,-41.23998,-41.24096,-41.24212,-41.2427,-41.24325,-41.24358,-41.24399,-41.24428,-41.24466,-41.24504,-41.24559,-41.24611,-41.24643,-41.24669,-41.24694,-41.24716,-41.24745,-41.24769,-41.24793,-41.24827,-41.2486,-41.24909,-41.24952,-41.25016,-41.25095,-41.25122,-41.25146,-41.25166,-41.25183,-41.25205,-41.25225,-41.25254,-41.25276,-41.25319,-41.25371,-41.25431,-41.25476,-41.25502,-41.25537,-41.25573,-41.25605,-41.25676,-41.25691,-41.25713,-41.25738,-41.25767,-41.25806,-41.25847,-41.25891,-41.25928,-41.25957,-41.25996,-41.2603,-41.26068,-41.26093,-41.2611,-41.26128,-41.26145,-41.26161,-41.26179,-41.26197,-41.26223,-41.2624,-41.26259,-41.26282,-41.26311,-41.26343,-41.26478,-41.26519,-41.26684,-41.26711,-41.26791,-41.2698,-41.27019,-41.27036,-41.27167,-41.27188,-41.27199,-41.27213,-41.27225,-41.27237,-41.27251,-41.27276,-41.27305,-41.27312,-41.27349,-41.27371,-41.27415,-41.27455,-41.27457,-41.27479,-41.27492,-41.27502,-41.27513,-41.27551,-41.27556,-41.27555,-41.27562]}]],null,null,{&#34;lineCap&#34;:null,&#34;lineJoin&#34;:null,&#34;clickable&#34;:true,&#34;pointerEvents&#34;:null,&#34;className&#34;:&#34;&#34;,&#34;stroke&#34;:true,&#34;color&#34;:&#34;#000000&#34;,&#34;weight&#34;:3,&#34;opacity&#34;:1,&#34;fill&#34;:false,&#34;fillColor&#34;:&#34;#000000&#34;,&#34;fillOpacity&#34;:0.2,&#34;dashArray&#34;:null,&#34;smoothFactor&#34;:1,&#34;noClip&#34;:false},&#34;29m 15.3s , 34.3kms&#34;,null,null]},{&#34;method&#34;:&#34;addMarkers&#34;,&#34;args&#34;:[-41.1250097,175.0845498,null,null,null,{&#34;clickable&#34;:true,&#34;draggable&#34;:false,&#34;keyboard&#34;:true,&#34;title&#34;:&#34;&#34;,&#34;alt&#34;:&#34;&#34;,&#34;zIndexOffset&#34;:0,&#34;opacity&#34;:1,&#34;riseOnHover&#34;:false,&#34;riseOffset&#34;:250},&#34;10 Aragon Grove, Kingsley Heights, Upper Hutt 5018, New Zealand&#34;,null,null,null,null]},{&#34;method&#34;:&#34;addMarkers&#34;,&#34;args&#34;:[-41.2756572,174.7811653,null,null,null,{&#34;clickable&#34;:true,&#34;draggable&#34;:false,&#34;keyboard&#34;:true,&#34;title&#34;:&#34;&#34;,&#34;alt&#34;:&#34;&#34;,&#34;zIndexOffset&#34;:0,&#34;opacity&#34;:1,&#34;riseOnHover&#34;:false,&#34;riseOffset&#34;:250},&#34;1 Pipitea St, Pipitea, Wellington 6011, New Zealand&#34;,null,null,null,null]}],&#34;limits&#34;:{&#34;lat&#34;:[-41.2756572,-41.11531],&#34;lng&#34;:[174.7781,175.08483]}},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;/div&gt;



&lt;!-- BLOGDOWN-HEAD

&lt;script src=&#34;#####../content/post/routing_files/htmlwidgets-0.8/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;#####../content/post/routing_files/jquery-1.11.1/jquery.min.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;#####../content/post/routing_files/leaflet-0.7.3/leaflet.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;#####../content/post/routing_files/leaflet-0.7.3/leaflet.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;#####../content/post/routing_files/leafletfix-1.0.0/leafletfix.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;link href=&#34;#####../content/post/routing_files/leaflet-label-0.2.2/leaflet.label.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;#####../content/post/routing_files/leaflet-label-0.2.2/leaflet.label.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;#####../content/post/routing_files/leaflet-binding-1.0.1.9004/leaflet.js&#34;&gt;&lt;/script&gt;





/BLOGDOWN-HEAD --&gt;
</description>
    </item>
    
    <item>
      <title>Using R Packages to Disseminate Data</title>
      <link>/post/datapackages/</link>
      <pubDate>Wed, 20 Jul 2016 00:00:00 +0000</pubDate>
      
      <guid>/post/datapackages/</guid>
      <description>&lt;!-- BLOGDOWN-BODY-BEFORE

/BLOGDOWN-BODY-BEFORE --&gt;

&lt;div id=&#34;introduction&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Introduction&lt;/h1&gt;
&lt;p&gt;R packages can include datasets, and it is very common to do so. This shouldn’t really come as a surprise–R is a statistical language in the end, and it is normal to include working examples with pacakges; and including datasets against which to run unit tests and other examples is clearly a useful thing to do.&lt;/p&gt;
&lt;p&gt;But datasets themselves aren’t central to most packages–statistical methodologies often are, and the data is there for testing or illustrative purposes. But this doesn’t have to be the case. For analysts familiar with R, consuming packages to obtain data might be quite convenient. But we can also bundle functionality specific to the included datasets, possibly increasing its overall utility. For example, one could include pre-canned statistical analyses in the form of simple helper functions or interactive &lt;code&gt;shiny&lt;/code&gt; applications.&lt;/p&gt;
&lt;p&gt;In this document, we look at a couple of datasets available from the &lt;a href=&#34;http://www.stats.govt.nz&#34;&gt;Statistics New Zealand&lt;/a&gt; website and consider the ways in which value might be added by disseminating this data via an R package (or set of packages) along with bundled demo apps.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;anatomy-of-an-r-package&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Anatomy of an R Package&lt;/h1&gt;
&lt;p&gt;An R package is essentially an eponymously named folder which bundles additional functionality in a standardised way, and which can be loaded on demand. A package contains, among other things, function and type definitions, documentation, and datasets.&lt;/p&gt;
&lt;p&gt;Traditionally, a loadable version of a package would be built from a source repository by running shell commands such as:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;R CMD INSTALL --build pkgname&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;or&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;R CMD build pkgname 
R CMD install pkgname.tar.gz&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;depending on the target platform. It is not all that difficult to build a modest package, but it can be tedious to construct packages from scratch. Large packages, on the other hand, can be difficult to build and manage. Those interested in the detail should refer to:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://cran.r-project.org/&#34;&gt;Writing R Extensions&lt;/a&gt;&lt;/p&gt;
&lt;div id=&#34;building-packages-in-rstudio&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Building packages in RStudio&lt;/h2&gt;
&lt;p&gt;RStudio has a number of productivity features which greatly assist the authoring of packages. RStudio allows users to work with projects, and packages can be authored by creating a project with type ‘R Package’:&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;../../img/datapackages/package01.png&#34; alt=&#34;Project-&amp;gt;New Project…&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;Project-&amp;gt;New Project…&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;../../img/datapackages/package02.png&#34; alt=&#34;Create Project&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;Create Project&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;../../img/datapackages/package03.png&#34; alt=&#34;Project Type&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;Project Type&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;../../img/datapackages/package04.png&#34; alt=&#34;Create R Package&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;Create R Package&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;When working on a package, RStudio provides a number of useful tools via a ‘Build’ menu. From there you can build the package and create source or binary packages for dissemination.&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;../../img/datapackages/package05.png&#34; alt=&#34;Build menu&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;Build menu&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;In addition to this, help files can be built automatically from source code comments using the &lt;code&gt;roxygen2&lt;/code&gt; package. The traditional method is to make a markup file for each function that requires documentation, but using &lt;code&gt;roxygen2&lt;/code&gt; is far more convenient. We’ll see examples below, but for a reasonable overview see:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://r-pkgs.had.co.nz/man.html&#34;&gt;Object documentation&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Finally, a package source code can be managed via either of git or subversion, which brings obvious advantage.&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;../../img/datapackages/versioning.png&#34; alt=&#34;Version control&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;Version control&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;single-function-shiny-applications&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Single-function Shiny Applications&lt;/h1&gt;
&lt;p&gt;It is possible to make 1-page web applications in R via the &lt;code&gt;shiny&lt;/code&gt; package. There are a number of ways a &lt;code&gt;shiny&lt;/code&gt; application can be created, and RStudio tries to help out here as well.&lt;/p&gt;
&lt;p&gt;For example, selecting File → New File → Shiny Web App… in RStudio will cause RStudio to create a small working app which you can use as a starting point:&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;../../img/datapackages/shiny01.png&#34; alt=&#34;Shiny web app&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;Shiny web app&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;../../img/datapackages/shiny02.png&#34; alt=&#34;New Shiny Web Application&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;New Shiny Web Application&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;../../img/datapackages/shiny03.png&#34; alt=&#34;Shiny application running within RStudio IDE&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;Shiny application running within RStudio IDE&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;A &lt;code&gt;shiny&lt;/code&gt; application is essentially made of a &lt;code&gt;ui&lt;/code&gt; component which contains the UI definition and a &lt;code&gt;server&lt;/code&gt; component which contains all the server-side logic for the application. Given these components, there are then a number of ways of creating and running an application. For example, one could create files &lt;code&gt;foo/ui.R&lt;/code&gt; and &lt;code&gt;foo/server.R&lt;/code&gt; which contain the &lt;code&gt;ui&lt;/code&gt; and &lt;code&gt;server&lt;/code&gt; components, respectively, and then run the application by calling:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;shiny::runApp(&amp;quot;foo&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Alternatively, if &lt;code&gt;ui&lt;/code&gt; and &lt;code&gt;server&lt;/code&gt; are actual R objects, one could run an application via&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;shiny::runApp(list(ui=ui, server=server))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;or even&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;shiny::shinyApp(ui=ui, server=server)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;But, of course, we can then write a function which returns one of these application objects. For example&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;foo &amp;lt;- function(){
   shinyApp(ui=ui, server=server)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;so that an application can be started, then, simply by calling:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;foo()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In fact, this is what we will do here. We will include functions in the packages we create which do nothing but cause a &lt;code&gt;shiny&lt;/code&gt; application to run. Thus, we can provide users with data, but also interactive applications that make use of that data.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;examplecensus-meshblock-dataset&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Example–Census Meshblock Dataset&lt;/h1&gt;
&lt;p&gt;For our first example, let us consider the Census Meshblock Dataset. From the &lt;a href=&#34;http://www.stats.govt.nz/Census/2013-census/data-tables/meshblock-dataset.aspx&#34;&gt;Statistics New Zealand website&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;2013 Census meshblock dataset contains counts at meshblock and other geographic levels for selected variables from the 2013, 2006, and 2001 Censuses. The geographies correspond to 2013 Census boundaries. The counts are at the highest level of each variable’s classification.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;The meshblock dataset is in Excel (.xlxs) and CSV format and can be integrated with analytical or mapping systems (using geographic boundary files), enabling further analysis of census data.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We’ll look specifically at the &lt;a href=&#34;http://www3.stats.govt.nz/meshblock/2013/csv/2013_mb_dataset_Total_New_Zealand_CSV.zip&#34;&gt;downloadable CSV file&lt;/a&gt;, primarily because the CSV file would be of the most universal use to any kind of data analyst (casual users might use the Excel version, but even those users might find it more useful to use the R version we’ll create here).&lt;/p&gt;
&lt;div id=&#34;repairing-reorganising-the-data&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Repairing / reorganising the data&lt;/h2&gt;
&lt;p&gt;This data has a number of organisational issues that impedes its use, so I spent a bit of time tidying things up and put the results in a package called &lt;a href=&#34;https://github.com/cmhh/NZCensus&#34;&gt;NZCensus&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;making-a-package&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Making a package&lt;/h2&gt;
&lt;p&gt;Here we make a simple package which does nothing but provide the following five datasets:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;datadictionary&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;dwelling&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;household&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;family&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;individual&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;That is, once installed, users can refer to any of these datasets by name if the package is loaded, or else load any of the datasets into memory by calling:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;data(dataset, package=&amp;quot;NZCensus&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Note that if all 5 datasets were loaded into memory, the total footprint would be 318MB. However, the package itself weighs in at 40.3MB–this compares favourably with the original CSV source (a zip file), which weighs in at 37.6MB.&lt;/p&gt;
&lt;p&gt;We use RStudio’s integrated support for packages to make this as easy as possible. We create a project called &lt;code&gt;NZCensus&lt;/code&gt;, which will also become the name of the package. The basic layout is as follows:&lt;/p&gt;
&lt;pre class=&#34;asis&#34;&gt;&lt;code&gt;NZCensus/data/datadictionary.rda
NZCensus/data/dwelling.rda
NZCensus/data/family.rda
NZCensus/data/household.rda
NZCensus/data/individual.rda
NZCensus/inst/doc/datadictionary.xlsx
NZCensus/inst/doc/datadictionary.ods
NZCensus/inst/doc/datadictionary.csv
NZCensus/man/datadictionary.Rd
NZCensus/man/dwelling.Rd
NZCensus/man/family.Rd
NZCensus/man/housheold.Rd
NZCensus/man/individual.Rd
NZCensus/R/data.R
NZCensus/DESCRIPTION
NZCensus/NAMESPACE&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The &lt;code&gt;*.rda&lt;/code&gt; files are datasets in R’s native format, and are compressed. For example, the individual dataset is 209.8MB uncompressed in-memory. But this can be compressed and saved to disk by running:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;save(individual, file = &amp;quot;individual&amp;quot;, compress = TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;with the resulting file in this case being just 28.7MB.&lt;/p&gt;
&lt;p&gt;R packages are usually very well documented. Here, we take advantage of &lt;code&gt;doxygen2&lt;/code&gt; to build help files automatically from the package R scripts. In this case, we don’t actually have any R code, but we fake it anyway. We create entries for each dataset in a file called &lt;code&gt;./NZCensus/R/data.R&lt;/code&gt;. For example, for the &lt;code&gt;dwelling&lt;/code&gt; dataset we include the following:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;#&amp;#39; New Zealand Census of Population and Dwellings dwelling data
#&amp;#39;
#&amp;#39; A dataset containing dwelling counts at various geographic levels.
#&amp;#39;
#&amp;#39; @format A data table with columns:
#&amp;#39; \describe{
#&amp;#39;   \item{geography}{Geographic level.  One of MB (meshblock), AU (area unit),
#&amp;#39;   Ward, TA (Territorial Authority), or RC (Regional Council).}
#&amp;#39;   \item{code}{Geography code.}
#&amp;#39;   \item{description}{Geography description.}
#&amp;#39;   \item{year}{Census year.  One of 2001, 2006, or 2013.}
#&amp;#39;   Other variables are documented in \code{\link{datadictionary}}.
#&amp;#39; }
#&amp;#39; @source
#&amp;#39; \url{http://www.stats.govt.nz/Census/2013-census/data-tables/meshblock-dataset.aspx}
&amp;quot;dwelling&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Processing this file yields, among other things, &lt;code&gt;NZCensus/man/dwelling.Rd&lt;/code&gt;, which is in R’s own documentation format. And after actually building and installing this package, an HTML version of this file is created which can be queried from R via something like:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;?NZCensus::dwelling&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;../../img/datapackages/dwellinghelp.png&#34; alt=&#34;Help for dwelling dataset.&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;Help for &lt;code&gt;dwelling&lt;/code&gt; dataset.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Besides this, RStudio also automates the creation of other files, but several files were also created manually. For example, files were added to the folder &lt;code&gt;NZCensus/inst/doc/&lt;/code&gt;, and once the package has been installed, these are available from the main help page via the &lt;code&gt;User guides, package vignettes and other documentation.&lt;/code&gt; link.&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;../../img/datapackages/NZCensushelp.png&#34; alt=&#34;help(package=&amp;quot;NZCensus&amp;quot;).&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;&lt;code&gt;help(package=&amp;quot;NZCensus&amp;quot;)&lt;/code&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;../../img/datapackages/NZCensusdoc.png&#34; alt=&#34;NZCensus docs.&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;&lt;code&gt;NZCensus&lt;/code&gt; docs.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;In this case, these files are just versions of the &lt;code&gt;datadictionary&lt;/code&gt; dataset that can be opened in Excel or LibreOffice (what used to be known as OpenOffice).&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;extending-the-package&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Extending the package&lt;/h2&gt;
&lt;p&gt;Above, we wrapped five datasets up as a package which we called &lt;code&gt;NZCensus&lt;/code&gt;. We can add value to packages by bundling other interesting functions along with the data. For example, we could write a function that takes a particular variable name as input, and plots that variable for each Census year.&lt;/p&gt;
&lt;p&gt;In this case, we’ll create two functions that provide &lt;code&gt;shiny&lt;/code&gt; applications in the way described above:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;mapdemo&lt;/code&gt; - an interactive map which displays a choropleth based on user input&lt;/li&gt;
&lt;li&gt;&lt;code&gt;distributiondemo&lt;/code&gt; - an barplot showing the distribution of a categorical variable selected by the user.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We place these functions in a new package called &lt;a href=&#34;https://github.com/cmhh/NZCensusDemos&#34;&gt;&lt;code&gt;NZCensusDemos&lt;/code&gt;&lt;/a&gt; which has an explicit dependency on the &lt;code&gt;NZCensus&lt;/code&gt; package, among others. The main reason for this is that we will bundle some additional spatial feature classes required to draw geographical features such as regional council areas on a map. The feature classes aren’t terribly terribly large (we haven’t included, amusingly, the meshblock feature class, which is pretty large), but at least this way users who only want the Census datasets aren’t burdened with the extra bulk implied by the demo package if they don’t want it. Similarly, the demos have dependencies which would need to be installed along with them, and loaded any time the demo package is. So, again, if users have no need for the demos, then they wouldn’t be forced to install these additional dependencies if they didn’t want them.&lt;/p&gt;
&lt;p&gt;Either way, the &lt;code&gt;mapdemo&lt;/code&gt; function, heavily edited, looks as follows:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;mapdemo &amp;lt;- function(){
   shinyApp(
      ui = fluidPage(
         titlePanel(&amp;quot;Mapping Census...&amp;quot;),
         sidebarLayout(
            sidebarPanel(width=3,
               ...
            ),
            mainPanel(width=9,
               ...
            )
         )
      ),
      server = function(input, output){
         ...
      }
   )
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It can then be called via:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(NZCensusDemos)
mapdemo()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and looks as follows:&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;../../img/datapackages/NZCensusMapDemo.png&#34; alt=&#34;NZCensusDemos::mapdemo()&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;&lt;code&gt;NZCensusDemos::mapdemo()&lt;/code&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Similarly, the &lt;code&gt;distributiondemo&lt;/code&gt; can be called via:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;distributiondemo()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and looks as follows:&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;../../img/datapackages/NZCensusDistributionDemo.png&#34; alt=&#34;NZCensusDemos::distributiondemo()&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;&lt;code&gt;NZCensusDemos::distributiondemo()&lt;/code&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;examplehlfs-time-series-data&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Example–HLFS Time Series Data&lt;/h1&gt;
&lt;p&gt;Since looking at the Census meshblock dataset had convinced myself that putting data in R pacakges was a useful thing to do, I started thinking about other datasets for which this sort of treatment might also be useful.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://www.stats.govt.nz&#34;&gt;Statistics New Zealand&lt;/a&gt; puts bulk CSV files on their website containing a number of time series, and that seemed a reasonable choice. We can use this data to produce a &lt;code&gt;shiny&lt;/code&gt; application which lets users explore a range time series and make selections to plot.&lt;/p&gt;
&lt;div id=&#34;preparing-the-data-sets&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Preparing the data sets&lt;/h2&gt;
&lt;p&gt;The data I decided to use is labour market data found via the &lt;a href=&#34;http://www.stats.govt.nz/tools_and_services/releases_csv_files.aspx&#34;&gt;CSV files for download&lt;/a&gt; page here:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://www.stats.govt.nz/~/media/Statistics/Browse%20for%20stats/LabourMarketStatistics/HOTPMar16qtr/lms-mar16-zipped-csv-tables.zip&#34;&gt;Income and work&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The data consists of 14 columns, and 605535 rows. There isn’t any major problems with this data–it’s perfectly usable as it is. However there is a fair bit of duplication:&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;../../img/datapackages/rawlabmkt.png&#34; alt=&#34;lots of duplication!&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;lots of duplication!&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Specifically, the &lt;code&gt;subject&lt;/code&gt;, &lt;code&gt;group&lt;/code&gt;, and title columns are unique by &lt;code&gt;series_reference&lt;/code&gt;. So, we split the table into two tables which have &lt;code&gt;series_reference&lt;/code&gt; as a common key, and remove as much duplication as possible. In addtion, we take the opportunity to cast the variable &lt;code&gt;Period&lt;/code&gt; to a genuine date-type variable.&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;../../img/datapackages/metadata.png&#34; alt=&#34;metadata&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;metadata&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;../../img/datapackages/labmkt.png&#34; alt=&#34;metadata&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;metadata&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;making-a-package-1&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Making a package&lt;/h2&gt;
&lt;p&gt;In this case, the data is relatively small, and for convenience we bundle the data and demos together. We create a package called &lt;a href=&#34;https://github.com/cmhh/SNZlabmkt&#34;&gt;&lt;code&gt;SNZlabmkt&lt;/code&gt;&lt;/a&gt; which contains the two data sets, &lt;code&gt;metadata&lt;/code&gt; and &lt;code&gt;labmkt&lt;/code&gt;, as well as a single function, &lt;code&gt;timeseriesdemo&lt;/code&gt;, which provides a &lt;code&gt;shiny&lt;/code&gt; application which plots time series based on user input. Since it has been discussed above, we skip the details of package creation here. But the demo is triggered by calling:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(SNZlabmkt)
timeseriesdemo()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and it looks as follows:&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;../../img/datapackages/SNZlabmktTSDemo.png&#34; alt=&#34;timeseriesdemo()&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;&lt;code&gt;timeseriesdemo()&lt;/code&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;try-it-out&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Try it out…&lt;/h1&gt;
&lt;p&gt;The packages discussed here have all been uploaded to GitHub. RStudio has excellent integration with Git, as noted earlier, and allows users to use GitHub to set a remote repository.&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;../../img/datapackages/git01.png&#34; alt=&#34;Git&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;Git&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;../../img/datapackages/git02.png&#34; alt=&#34;Git&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;Git&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;../../img/datapackages/git03.png&#34; alt=&#34;Git diff&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;Git diff&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;To install the packages:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;if (!require(devtools)) install.packages(&amp;quot;devtools&amp;quot;)
devtools::install_github(&amp;quot;cmhh/NZCensus&amp;quot;)
devtools::install_github(&amp;quot;cmhh/NZCensusDemos&amp;quot;)
devtools::install_github(&amp;quot;cmhh/SNZlabmkt&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If for some reason this fails, download each file manually through from:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/cmhh/NZCensus/archive/master.zip&#34;&gt;NZCensus&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/cmhh/NZCensusDemos/archive/master.zip&#34;&gt;NZCensusDemos&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/cmhh/SNZlabmkt/archive/master.zip&#34;&gt;SNZlabmkt&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Then install each zip file in turn as follows:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;devtools::install_local(&amp;quot;path-to-zip/NZCensus-master.zip&amp;quot;)
devtools::install_local(&amp;quot;path-to-zip/NZCensusDemos-master.zip&amp;quot;)
devtools::install_local(&amp;quot;path-to-zip/SNZlabmkt-master.zip&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;



&lt;!-- BLOGDOWN-HEAD






/BLOGDOWN-HEAD --&gt;
</description>
    </item>
    
  </channel>
</rss>