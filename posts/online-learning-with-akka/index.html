<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.393">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Chris Hansen">
<meta name="dcterms.date" content="2021-08-08">
<meta name="description" content="Imagine an online learning scenario where we wish to update an existing model using streaming event data, say. Here we consider how we might approach such a problem using the actor model as implemented by Akka.">

<title>cmhh - Online Learning with Akka</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link id="quarto-text-highlighting-styles" href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>
    .quarto-title-banner {
      background-image: url(../../img/banner-2.jpg);
background-size: cover;
    }
    </style>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../css/styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">cmhh</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/cmhh"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Online Learning with Akka</h1>
                          <div class="quarto-categories">
                <div class="quarto-category">online learning</div>
                <div class="quarto-category">Scala</div>
                <div class="quarto-category">Akka</div>
                <div class="quarto-category">Deeplearning4j</div>
              </div>
                  </div>
  </div>
    
  <div>
    <div class="description">
      Imagine an online learning scenario where we wish to update an existing model using streaming event data, say. Here we consider how we might approach such a problem using the actor model as implemented by Akka.
    </div>
  </div>




  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Chris Hansen </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 8, 2021</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#problem-description" id="toc-problem-description" class="nav-link" data-scroll-target="#problem-description">Problem Description</a></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation">Implementation</a>
  <ul class="collapse">
  <li><a href="#serialisation-deserialisation" id="toc-serialisation-deserialisation" class="nav-link" data-scroll-target="#serialisation-deserialisation">Serialisation / Deserialisation</a></li>
  <li><a href="#model-our-messages" id="toc-model-our-messages" class="nav-link" data-scroll-target="#model-our-messages">Model Our Messages</a></li>
  </ul></li>
  <li><a href="#using-the-actors" id="toc-using-the-actors" class="nav-link" data-scroll-target="#using-the-actors">Using the Actors</a>
  <ul class="collapse">
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="overview" class="level1">
<h1>Overview</h1>
<p>In a <a href="../../posts/online-learning-with-apache-kafka">previous post</a>, we looked at how we could consume messages in a Kafka topic, and use those messages for online training of a classifier. In this post, we look at how Akka could be used to solve the same problem, in broadly the same way. Akka is an implementation of the actor model, and is particularly well suited for building event-driven, reactive systems since the <em>actors</em> involved communicate exclusively by sending and reacting to messages.</p>
</section>
<section id="problem-description" class="level1">
<h1>Problem Description</h1>
<p>As before, we download the popular <a href="http://yann.lecun.com/exdb/mnist/">MNIST database of handwritten digits</a>. The database contains hand-written digits represented as 28x28 pixel arrays with integer values in the range \([0,255]\) representing grey-scale colours. The images are split into training and test sets with 60000 and 10000 images, respectively. The following image contains a collage of randomly selected examples:</p>
<p><img src="assets/random1.png" class="img-fluid" style="width: 100%"></p>
<p>I must confess that I am a HUGE Akka fan, and in this case I think it is <em>cooler</em> than Kafka, even if perhaps not as well suited to situations requiring <em>extremely</em> high throughput. All that said, I’m not yet that familiar with the newer typed actors, so things here might not be completely idiomatic.</p>
<p>Our solution will consist of three actors which we’ll call <em>producer</em>, <em>consumer</em>, and <em>coordinator</em> for lack of anything better. When sent a labelled image, our consumer will use that image to update a classifier, but our consumer will also respond to other message types. Specifically, when asked, the producer will send the current accuracy over the MNIST test set, and it will also send the actual classifier on request. The producer will simply send messages to the consumer whenever we tell it to.</p>
</section>
<section id="implementation" class="level1">
<h1>Implementation</h1>
<p>The complete application can be found on GitHub at <a href="https://github.com/cmhh/akkatrain">cmhh/akkatrain</a>, and the <code>README</code> includes enough information to get up and running. Note that the repository includes the <a href="http://yann.lecun.com/exdb/mnist/">MNIST database</a> since the data is only 12MB all up, and the original source urges users to ‘Please refrain from accessing these files from automated scripts with high frequency. Make copies!’. Either way, in this section we discuss the most important bits in more detail.</p>
<section id="serialisation-deserialisation" class="level2">
<h2 class="anchored" data-anchor-id="serialisation-deserialisation">Serialisation / Deserialisation</h2>
<p>Akka is designed to be scalable, and our actor system can be spread across multiple JVM instances, on disparate servers. For actors to communicate with each other outside a single JVM instance, we would need to serialise our messages. Custom serialisers are easy enough to make–we simply create a class which mixes in <code>akka.serialization.Serializer</code>, and then we add entries in the <code>akka.actor.serializers</code> and <code>akka.actor.serialization-bindings</code> section of our configuration (see <a href="https://doc.akka.io/docs/akka/current/serialization.html">Serialization</a>) to make use of them. However, in this example we limit ourselves to a single JVM instance, and so we do not need to worry.</p>
</section>
<section id="model-our-messages" class="level2">
<h2 class="anchored" data-anchor-id="model-our-messages">Model Our Messages</h2>
<p>In order to send labelled images, we’ll re-use the <code>MnistRecord</code> type from the <a href="../../posts/online-learning-with-apache-kafka">Kafka implementation</a>, so, please excuse the duplication…</p>
<p>The MNIST database consists of handwritten images of 28x28 pixels, each assigned a label from 0 to 9. The image data is easily read from the provided files as an array of bytes in row-major order, so we define a simple case class as follows (the class has a number of methods, but we omit the details here):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="kw">class</span> <span class="ex">Image</span><span class="op">(</span>data<span class="op">:</span> <span class="ex">Array</span><span class="op">[</span><span class="ex">Byte</span><span class="op">],</span> rows<span class="op">:</span> <span class="bu">Int</span><span class="op">,</span> cols<span class="op">:</span> <span class="bu">Int</span><span class="op">,</span> byrow<span class="op">:</span> <span class="ex">Boolean</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Labelled images can then be modelled simply, also using a case class, as follows:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="kw">class</span> <span class="fu">MnistRecord</span><span class="op">(</span>image<span class="op">:</span> <span class="ex">Image</span><span class="op">,</span> label<span class="op">:</span> <span class="bu">Int</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The MNIST data has been bundled as a resource in the provided sbt project, and a basic, single-use iterator is provided also. For example, to read the training data:</p>
<div class="repl">
<div class="sourceCode" id="cb3"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>scala<span class="op">&gt;</span> <span class="kw">val</span> testIt <span class="op">=</span> <span class="fu">MnistIterator</span><span class="op">(</span>MnistType<span class="op">.</span>TRAIN<span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> testIt<span class="op">:</span> org<span class="op">.</span>cmhh<span class="op">.</span>MnistIterator <span class="op">=</span> <span class="op">&lt;</span>iterator<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The rest of our messages will be modelled as singleton objects, or very simple case classes:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> akka<span class="op">.</span>actor<span class="op">.</span>typed<span class="op">.</span>ActorRef</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> org<span class="op">.</span>deeplearning4j<span class="op">.</span>nn<span class="op">.</span>multilayer<span class="op">.</span>MultiLayerNetwork</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">object</span> messages <span class="op">{</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">sealed</span> <span class="kw">trait</span> CoordinatorCommand </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="kw">object</span> RequestAccuracy <span class="kw">extends</span> CoordinatorCommand</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="kw">class</span> <span class="fu">RequestSendImages</span><span class="op">(</span>n<span class="op">:</span> <span class="bu">Int</span><span class="op">)</span> <span class="kw">extends</span> CoordinatorCommand</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="kw">class</span> <span class="fu">RequestClassifier</span><span class="op">(</span>f<span class="op">:</span> <span class="ex">String</span><span class="op">)</span> <span class="kw">extends</span> CoordinatorCommand</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="kw">object</span> Stop <span class="kw">extends</span> CoordinatorCommand <span class="kw">with</span> ProducerCommand <span class="kw">with</span> ConsumerCommand</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="kw">class</span> <span class="fu">Accuracy</span><span class="op">(</span>value<span class="op">:</span> <span class="ex">Double</span><span class="op">,</span> n<span class="op">:</span> <span class="bu">Int</span><span class="op">)</span> <span class="kw">extends</span> CoordinatorCommand</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="kw">class</span> <span class="fu">Classifier</span><span class="op">(</span>value<span class="op">:</span> MultiLayerNetwork<span class="op">,</span> f<span class="op">:</span> <span class="ex">String</span><span class="op">)</span>  <span class="kw">extends</span> CoordinatorCommand</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">sealed</span> <span class="kw">trait</span> ProducerCommand</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="kw">class</span> <span class="fu">SendImages</span><span class="op">(</span>sendTo<span class="op">:</span> ActorRef<span class="op">[</span>ConsumerCommand<span class="op">],</span> n<span class="op">:</span> <span class="bu">Int</span><span class="op">)</span> <span class="kw">extends</span> ProducerCommand</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">sealed</span> <span class="kw">trait</span> ConsumerCommand</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="kw">class</span> <span class="ex">Image</span><span class="op">(</span>image<span class="op">:</span> MnistRecord<span class="op">)</span> <span class="kw">extends</span> ConsumerCommand</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="kw">class</span> <span class="fu">SendAccuracy</span><span class="op">(</span>replyTo<span class="op">:</span> ActorRef<span class="op">[</span>Accuracy<span class="op">])</span> <span class="kw">extends</span> ConsumerCommand</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="kw">class</span> <span class="fu">SendClassifier</span><span class="op">(</span>replyTo<span class="op">:</span> ActorRef<span class="op">[</span>Classifier<span class="op">],</span> f<span class="op">:</span> <span class="ex">String</span><span class="op">)</span> <span class="kw">extends</span> ConsumerCommand </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>All our producer does is send <span class="math inline">\(n\)</span> images to the consumer, and it does this when sent a <code>SendImages</code> object. In this case, the producer sends messages but does not expect any sort of reply. The producer will also terminate when sent the <code>Stop</code> object, but also once it has traversed the full MNIST training set once (again, we’re simulating online learning here–it would be straightforward to implement other training scenarios, traversing the training set as many times as required, for example, and in a random order). The full implementation is as follows:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> akka<span class="op">.</span>actor<span class="op">.</span>typed<span class="op">.</span>scaladsl<span class="op">.</span>Behaviors</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> akka<span class="op">.</span>actor<span class="op">.</span>typed<span class="op">.</span>scaladsl<span class="op">.</span>LoggerOps</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> akka<span class="op">.</span>actor<span class="op">.</span>typed<span class="op">.</span>Behavior</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">object</span> Producer <span class="op">{</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">import</span> messages<span class="op">.</span>_</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="kw">val</span> images <span class="op">=</span> <span class="fu">MnistIterator</span><span class="op">(</span>MnistType<span class="op">.</span>TRAIN<span class="op">)</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">apply</span><span class="op">():</span> Behavior<span class="op">[</span>ProducerCommand<span class="op">]</span> <span class="op">=</span> </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    Behaviors<span class="op">.</span>receive<span class="op">[</span>ProducerCommand<span class="op">]{</span> <span class="op">(</span>context<span class="op">,</span> message<span class="op">)</span> <span class="op">=&gt;</span> </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>      message <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="fu">SendImages</span><span class="op">(</span>r<span class="op">,</span> n<span class="op">)</span> <span class="op">=&gt;</span> </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>          <span class="kw">def</span> <span class="fu">loop</span><span class="op">(</span>i<span class="op">:</span> <span class="bu">Int</span><span class="op">):</span> Behavior<span class="op">[</span>ProducerCommand<span class="op">]</span> <span class="op">=</span> </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>images<span class="op">.</span>hasNext<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>              <span class="fu">println</span><span class="op">(</span><span class="st">"All images sent.  Shutting down."</span><span class="op">)</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>              Behaviors<span class="op">.</span>stopped</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>              Behaviors<span class="op">.</span>same</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>              r <span class="op">!</span> <span class="ex">Image</span><span class="op">(</span>images<span class="op">.</span><span class="fu">next</span><span class="op">())</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>              <span class="fu">loop</span><span class="op">(</span>i <span class="op">+</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>          <span class="fu">loop</span><span class="op">(</span><span class="dv">0</span><span class="op">)</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> Stop <span class="op">=&gt;</span> </span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>          <span class="fu">println</span><span class="op">(</span><span class="st">"Producer is dead!"</span><span class="op">)</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>          Behaviors<span class="op">.</span>stopped</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Our consumer is a little more complicated, but is still relatively simple. It can receive messages as follows:</p>
<ul>
<li><code>Image</code> - when received, it will update its private classifier</li>
<li><code>SendAccuracy</code> - when received, it will send an <code>Accuracy</code> object to the sender</li>
<li><code>SendClassifier</code> - when received, it will send a <code>Classifier</code> object to the sender</li>
</ul>
<p>The full implementation of the consumer actors is as follows:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> akka<span class="op">.</span>actor<span class="op">.</span>typed<span class="op">.</span>scaladsl<span class="op">.</span>Behaviors</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> akka<span class="op">.</span>actor<span class="op">.</span>typed<span class="op">.</span>scaladsl<span class="op">.</span>LoggerOps</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> akka<span class="op">.</span>actor<span class="op">.</span>typed<span class="op">.</span>Behavior</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> org<span class="op">.</span>nd4j<span class="op">.</span>evaluation<span class="op">.</span>classification<span class="op">.</span>Evaluation</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="kw">object</span> Consumer <span class="op">{</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">import</span> messages<span class="op">.</span>_</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="kw">val</span> network <span class="op">=</span> model<span class="op">.</span><span class="fu">cnn</span><span class="op">()</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="kw">val</span> mnistTest <span class="op">=</span> <span class="kw">new</span> <span class="fu">MnistDataSetIterator</span><span class="op">(</span><span class="dv">100</span><span class="op">,</span> MnistType<span class="op">.</span>TEST<span class="op">)</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">apply</span><span class="op">():</span> Behavior<span class="op">[</span>ConsumerCommand<span class="op">]</span> <span class="op">=</span> <span class="fu">run</span><span class="op">(</span><span class="dv">0</span><span class="op">)</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">run</span><span class="op">(</span>n<span class="op">:</span> <span class="bu">Int</span><span class="op">):</span> Behavior<span class="op">[</span>ConsumerCommand<span class="op">]</span> <span class="op">=</span> </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    Behaviors<span class="op">.</span>receive<span class="op">{</span> <span class="op">(</span>context<span class="op">,</span> message<span class="op">)</span> <span class="op">=&gt;</span> message <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> <span class="ex">Image</span><span class="op">(</span>rec<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">val</span> im <span class="op">=</span> rec<span class="op">.</span>toNd4j</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        network<span class="op">.</span><span class="fu">fit</span><span class="op">(</span>im<span class="op">.</span>_1<span class="op">,</span> im<span class="op">.</span>_2<span class="op">)</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">run</span><span class="op">(</span>n <span class="op">+</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> <span class="fu">SendAccuracy</span><span class="op">(</span>replyTo<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        replyTo <span class="op">!</span> <span class="fu">Accuracy</span><span class="op">(</span>accuracy<span class="op">,</span> n<span class="op">)</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        Behaviors<span class="op">.</span>same</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> <span class="fu">SendClassifier</span><span class="op">(</span>replyTo<span class="op">,</span> f<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        replyTo <span class="op">!</span> <span class="fu">Classifier</span><span class="op">(</span>network<span class="op">.</span>clone<span class="op">,</span> f<span class="op">)</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        Behaviors<span class="op">.</span>same</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>      <span class="cf">case</span> Stop <span class="op">=&gt;</span> </span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        Behaviors<span class="op">.</span>stopped <span class="op">{()</span> <span class="op">=&gt;</span> </span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>          <span class="fu">println</span><span class="op">(</span><span class="st">"Consumer is dead!"</span><span class="op">)</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> accuracy<span class="op">:</span> <span class="ex">Double</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> eval <span class="op">=</span> network<span class="op">.</span>evaluate<span class="op">[</span>Evaluation<span class="op">](</span>mnistTest<span class="op">)</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    eval<span class="op">.</span>accuracy</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that actors can be created with an object-oriented or functional style, and we’ve opted for the functional approach here. So in the case of the consumer, we’ve tracked the number of total training images received, mostly to demonstrate how one might go about maintaining state–we <em>could</em> use mutable variables, but instead we define our <code>Behavior</code> recursively.</p>
<p>Rather than send messages directly to either of our producer or consumer actors, we communicate exclusively with a coordinator actor. We send the coordinator any of the following:</p>
<ul>
<li><code>RequestSendImage</code> - coordinator will tell the producer to send <code>Image</code>s to the consumer</li>
<li><code>RequestAccuracy</code> - coordinator will tell the consumer to send an <code>Accuracy</code> object</li>
<li><code>RequestClassifier</code> - coordinator will tell the consumer to send a <code>Classifier</code> object</li>
<li><code>Stop</code> - tell both the consumer and producer to <code>Stop</code></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> akka<span class="op">.</span>actor<span class="op">.</span>typed<span class="op">.</span>scaladsl<span class="op">.</span>Behaviors</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> akka<span class="op">.</span>actor<span class="op">.</span>typed<span class="op">.</span>scaladsl<span class="op">.</span>LoggerOps</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> akka<span class="op">.</span>actor<span class="op">.</span>typed<span class="op">.</span>Behavior</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> java<span class="op">.</span>io<span class="op">.</span><span class="ex">File</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="kw">object</span> Coordinator <span class="op">{</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">import</span> messages<span class="op">.</span>_</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">apply</span><span class="op">():</span> Behavior<span class="op">[</span>CoordinatorCommand<span class="op">]</span> <span class="op">=</span> Behaviors<span class="op">.</span>setup <span class="op">{</span> context <span class="op">=&gt;</span> </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> consumer <span class="op">=</span> context<span class="op">.</span><span class="fu">spawn</span><span class="op">(</span><span class="fu">Consumer</span><span class="op">(),</span> <span class="st">"consumer"</span><span class="op">)</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> producer <span class="op">=</span> context<span class="op">.</span><span class="fu">spawn</span><span class="op">(</span><span class="fu">Producer</span><span class="op">(),</span> <span class="st">"producer"</span><span class="op">)</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    Behaviors<span class="op">.</span>receiveMessage <span class="op">{</span> message <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>      message <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="fu">RequestSendImages</span><span class="op">(</span>n<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>          producer <span class="op">!</span> <span class="fu">SendImages</span><span class="op">(</span>consumer<span class="op">,</span> n<span class="op">)</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> RequestAccuracy <span class="op">=&gt;</span> </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>          consumer <span class="op">!</span> <span class="fu">SendAccuracy</span><span class="op">(</span>context<span class="op">.</span>self<span class="op">)</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="fu">RequestClassifier</span><span class="op">(</span>f<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>          consumer <span class="op">!</span> <span class="fu">SendClassifier</span><span class="op">(</span>context<span class="op">.</span>self<span class="op">,</span> f<span class="op">)</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="fu">Accuracy</span><span class="op">(</span>accuracy<span class="op">,</span> n<span class="op">)</span> <span class="op">=&gt;</span> </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>          <span class="fu">println</span><span class="op">(</span><span class="ss">f"</span><span class="st">accuracy: %%1.4f, training images seen: %%05d</span><span class="ss">"</span><span class="op">.</span><span class="fu">format</span><span class="op">(</span>accuracy<span class="op">,</span> n<span class="op">))</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="fu">Classifier</span><span class="op">(</span>n<span class="op">,</span> f<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>          n<span class="op">.</span><span class="fu">save</span><span class="op">(</span><span class="kw">new</span> <span class="ex">File</span><span class="op">(</span>f<span class="op">))</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> Stop <span class="op">=&gt;</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>          consumer <span class="op">!</span> Stop</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>          producer <span class="op">!</span> Stop</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>      Behaviors<span class="op">.</span>same</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}}</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="using-the-actors" class="level1">
<h1>Using the Actors</h1>
<p>We always need an actor system to provide the overall context, and while it might not be best practice, we can make our system from a <code>Coordinator</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> akka<span class="op">.</span>actor<span class="op">.</span>typed<span class="op">.</span>ActorSystem</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> system <span class="op">=</span> <span class="fu">ActorSystem</span><span class="op">(</span><span class="fu">Coordinator</span><span class="op">(),</span> <span class="st">"akkatrain"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then, to check the current classifier accuracy:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>system <span class="op">!</span> RequestAccuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To have 1000 images sent to the consumer actor:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>system <span class="op">!</span> <span class="fu">RequestSendImages</span><span class="op">(</span><span class="dv">1000</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To fetch the classifier and save it to a file:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>system <span class="op">!</span> <span class="fu">RequestClassifier</span><span class="op">(</span><span class="st">"mnist.model"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And to shut everything down:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>system <span class="op">!</span> Stop</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>system<span class="op">.</span><span class="fu">terminate</span><span class="op">()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The project contains a simple entry point which will create an actor system as above, and then send the full MNIST training set in batches of 500 images, reporting accuracy after each request. It is illustrative only, and uses <code>Thread.sleep()</code> to make things work <em>just so</em> (i.e., on a different machine with faster or slower performance, lack of GPU, etc., things will not work out so neatly!). The demo can be run as follows:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">java</span> <span class="at">-cp</span> target/scala-2.13/akkatrain.jar org.cmhh.Main</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="assets/akkatrain01.webp" class="img-fluid"></p>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>In this post we demonstrated the basic usage of Kafka’s typed actors. The specific use-case for our actor system was to react to new messages in real-time, using them to update a classifier. There are a number of extensions that we could consider to make this more interesting, of course–we could develop web interfaces for interacting with out actors, and we could look other parts of the Akka ecosystem such as Akka streams (though the goal here was specifically to use the actor model).</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>