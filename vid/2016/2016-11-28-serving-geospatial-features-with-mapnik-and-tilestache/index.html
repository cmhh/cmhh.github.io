<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>cmhh  | Serving Geospatial Features with Mapnik and TileStache</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css" />
    <link href="../../css/highlight/atom-one-dark-reasonable.css" rel='stylesheet' type='text/css' />
    <link rel="stylesheet" href="../../css/blog.css" />
    <link rel="stylesheet" href="../../css/custom.css" />
</head>
<body>

    
    <nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="../../">Home</a>
            
        </div>
    </nav>
    

    
    <section class="hero is-info is-medium">
        <div class="hero-body" style="background-image: url(/img/bg-blog-2.jpg);">
            <div class="container has-text-centered">
                <br>
                <h1 class="title is-size-1">
                    
                        Serving Geospatial Features with Mapnik and TileStache
                    
                </h1>
                
            </div>
        </div>
    </section>


<div class="container">
    <div class="section">
    

<div class="columns">
    <div class="column is-9">
        <div class="tile is-child box">
            <div class="content">
                <h1 id="overview">Overview</h1>
<p>When making maps for display on the web, the size of the various objects
being rendered can quickly become overwhelming.  For example, a polygon feature
class containing
<a href="http://www.stats.govt.nz/methods/classifications-and-standards/classification-related-stats-standards/meshblock/definition.aspx#">New Zealand Meshblocks</a>,
a set of roughly 40,000 mutually exclusive and exhaustive polygons, is more than
100MB when stored as a shapefile, but much larger uncompressed and rendered in
a browser window.</p>
<p>There are various approaches one can take to attempt to deal with this issue,
though useful solutions tend to depend on server-side processing.  Essentially,
one fetches and renders only as much data as is needed to populate the current
viewport.  One way of doing this is to use a tile server whereby a map is
represented as a grid made of individual <em>tiles</em>, and each tile is an image
which can be rendered and served on request.  For example:</p>
<img src=assets/020302.png class=large alt="http://tile.openstreetmap.org/2/3/2.png">
<p>In this document we consider two main tools: <a href="http://mapnik.org">Mapnik</a>, which
is used to render the individual tiles; and <a href="http://tilestache.org">TileStache</a>,
which is used to serve the tiles.</p>
<p>Mapnik can render tiles dynamically, thus avoiding the need to cache all the
required tiles in advance.  Maps themselves are styled via an XML file which
provides a good deal of control over map layout, and can be modified on demand.</p>
<p>Best of all, every tool used in this document is completely free.  So, in
principle, a production quality server could be created, with the only costs
incurred being the cost of the host server itself.  At current rates, a Linux
instance with 2 cores and 8GB of RAM could be created on AWS with an annual cost
of as little as $900.</p>
<h1 id="setting-things-up">Setting Things Up</h1>
<p>The host in question here is a VirtualBox VM running 64-bit Debian Linux
(Stretch), with 2 cores and 8GB of RAM assigned.  The instructions will likely
apply well enough to other Debian-based Linux distrubtions, such as Ubuntu.
Users of other Linux distributions will probably be able to use the instructions
here as a template.</p>
<p>It is possible to get things working on a Windows platform, albeit with slightly
less functionality.  However, my personal opinion is that it is much easier and
more reliable on a Linux platform, and Linux is strongly recommended.  Windows
users can easily get up and running with Linux by creating a virtual machine,
provided they have some RAM to spare.
<a href="https://www.virtualbox.org/">Oracle VM VirtualBox</a> is a perfectly good option,
and is also freely available.</p>
<h2 id="mapnik--tilestache">Mapnik &amp; TileStache</h2>
<p>Both Mapnik and TileStache are in the standard repositories, so installing is as
simple as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt-get install libmapnik libmapnik-dev mapnik-utils python-mapnik tilestache
</code></pre></div><p>TileStache also required the Python imaging library.  To install this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo pip install -U Pillow
</code></pre></div><h3 id="testing-the-installation">Testing the installation</h3>
<p>For development purposes TileStache can be started via the <code>tilestache-server</code>
command, which causes TileStache to run on port 8080 by default.</p>
<p>When starting, <code>tilestache-server</code> looks for a file called <code>tilestache.cfg</code>, so
we create one as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;layers&#34;</span>: 
  {
    <span style="color:#f92672">&#34;osm&#34;</span>:
    {
      <span style="color:#f92672">&#34;provider&#34;</span>: {<span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;proxy&#34;</span>, <span style="color:#f92672">&#34;url&#34;</span>: <span style="color:#e6db74">&#34;http://tile.openstreetmap.org/{Z}/{X}/{Y}.png&#34;</span>}
    }
  }
}
</code></pre></div><p>To start TileStache, run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">tilestache-server -c &lt;path to config&gt;/tilestache.cfg
</code></pre></div><p>which will then make the server available at
<a href="http://localhost:8080">http://localhost:8080</a>:</p>
<img src=assets/tiles.png class=large alt="http://localhost:8080">
<p>In this case, tiles from openstreetmap.org are available at
<code>/osm/{z}/{x}/{y}.png</code>:</p>
<img src=assets/000.crop.png class=large alt="http://localhost:8080/osm/0/0/0.png">
<h2 id="uwsgi--nginx-setup-optional">uWSGI + Nginx Setup (optional)</h2>
<p>The testing section above describes how one can run TileStache and Mapnik
together using the <code>tilestache-server</code> command, and is fine for development
purposes.  However, for a more performant, robust solution, we instead use
WSGI.</p>
<p>There are a few options we could employ here, but we will use
<a href="https://uwsgi-docs.readthedocs.io/en/latest/">uWSGI</a> to run TileStache, and
<a href="https://www.nginx.com/">NGINX</a> to reverse proxy.</p>
<h3 id="uwsgi">uWSGI</h3>
<p>One of the easier ways to install uWSGI is to use pip:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt-get install python-pip
sudo pip install -U uwsgi
</code></pre></div><p>Now, create a file called <code>/etc/tilestache/tilestache-uwsgi.ini</code> as follows
(note we have decided to use port 9090 rather than the default of 8080):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">[uwsgi]
http-socket = :9090
eval = import TileStache; application = TileStache.WSGITileServer(&#34;/etc/tilestache/tilestache.cfg&#34;)
</code></pre></div><p>Given this file, TileStache can then be started so that it is available at
<code>http://localhost:9090</code> via:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">uwsgi --ini /etc/tilestache/tilestache-uwsgi.ini
</code></pre></div><h3 id="starting-uwsgi-automatically-on-boot">Starting uWSGI automatically on boot</h3>
<p>We might also want to set things up so that the service starts automatically
when the system is booted.  Debian uses System V-style init.  I&rsquo;m not all that
experienced with this, but I got things working by creating
<code>/etc/init.d/tilestache</code> as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/sh
</span><span style="color:#75715e"></span>
<span style="color:#75715e">### BEGIN INIT INFO</span>
<span style="color:#75715e"># Provides:          tilestache</span>
<span style="color:#75715e"># Required-Start:    </span>
<span style="color:#75715e"># Required-Stop:     </span>
<span style="color:#75715e"># Default-Start:     2 3 4 5</span>
<span style="color:#75715e"># Default-Stop:      0 1 6</span>
<span style="color:#75715e"># Short-Description: Start TileStache.</span>
<span style="color:#75715e"># Description:       Start TileStache.</span>
<span style="color:#75715e">### END INIT INFO</span>

DAEMON<span style="color:#f92672">=</span>/usr/local/bin/uwsgi
NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;tilestache&#34;</span>

RUN_DIR<span style="color:#f92672">=</span>/var/run
PIDFILE<span style="color:#f92672">=</span>$RUN_DIR/tilestache.pid

<span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> in
    start<span style="color:#f92672">)</span>
      printf <span style="color:#e6db74">&#34;%-50s&#34;</span> <span style="color:#e6db74">&#34;Starting </span>$NAME<span style="color:#e6db74">...&#34;</span>
      PID<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>$DAEMON --ini /etc/tilestache/tilestache-uwsgi.ini &gt; /dev/null 2&gt;&amp;<span style="color:#ae81ff">1</span> &amp; echo $!<span style="color:#e6db74">`</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -z $PID<span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
        printf <span style="color:#e6db74">&#34;%s\n&#34;</span> <span style="color:#e6db74">&#34;Fail&#34;</span>
      <span style="color:#66d9ef">else</span>
        echo $PID &gt; $PIDFILE
        printf <span style="color:#e6db74">&#34;%s\n&#34;</span> <span style="color:#e6db74">&#34;done.&#34;</span>
      <span style="color:#66d9ef">fi</span>
    ;;

    stop<span style="color:#f92672">)</span>
      printf <span style="color:#e6db74">&#34;%-50s&#34;</span> <span style="color:#e6db74">&#34;Stopping </span>$NAME<span style="color:#e6db74">...&#34;</span>
      PID<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>cat $PIDFILE<span style="color:#e6db74">`</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -f $PIDFILE <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span> 
        kill -HUP $PID
        printf <span style="color:#e6db74">&#34;%s\n&#34;</span> <span style="color:#e6db74">&#34;done.&#34;</span>
        rm -f $PIDFILE
      <span style="color:#66d9ef">else</span>
        printf <span style="color:#e6db74">&#34;%s\n&#34;</span> <span style="color:#e6db74">&#34;no such process.&#34;</span>
      <span style="color:#66d9ef">fi</span>
      echo <span style="color:#e6db74">&#34;done.&#34;</span>
    ;;

    restart<span style="color:#f92672">)</span>
      $0 stop
      $0 start
    ;;

    *<span style="color:#f92672">)</span>
    echo <span style="color:#e6db74">&#34;Usage: </span>$0<span style="color:#e6db74"> {start|stop|restart}&#34;</span>
    exit <span style="color:#ae81ff">1</span>
    ;;
<span style="color:#66d9ef">esac</span>

exit <span style="color:#ae81ff">0</span>
</code></pre></div><p>and running:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo update-rc.d tilestache defaults
</code></pre></div><p>For those unfamiliar with Linux, this also means the service can be stopped and
restarted at will with commands like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo service tilestache start
sudo service tilestache stop
sudo servcee tilestache restart
</code></pre></div><p>Ubuntu, and possily other Linux distributions, now uses upstart rather than
System V-like init.  It&rsquo;s a simpler process to set up, so the details are left
to the reader if this applies (typically, create <code>/etc/init/tilestache.conf</code>
rather than <code>/etc/init.d/tilestache</code>, where <code>tilestache.conf</code> makes use of much
simpler syntax&ndash;see <a href="http://upstart.ubuntu.com/">upstart</a> for details).</p>
<p>Note that uWSGI has something called
<a href="http://uwsgi-docs.readthedocs.io/en/latest/Emperor.html">uWSGI Emperor</a>.  This
makes it possible to control multiple services from a single uWSGI instance&ndash;
just create <code>ini</code> files like <code>tilestache-uwsgi.ini</code> above.  This certainly has
some appeal.</p>
<h3 id="nginx">NGINX</h3>
<p>If you don&rsquo;t have NGINX, it can be installed as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt-get install nginx
</code></pre></div><p>To give the service a nice endpoint, and potentially make it available
externally, we add the following to <code>/etc/nginx/sites-available/default</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">server{

  ...
  
  location /tiles/ {
    include uwsgi_params;
    uwsgi_pass 127.0.0.1:9090;
  }
  
  ...

}
</code></pre></div><p>Apparently NGINX and uWSGI work together.  I couldn&rsquo;t quite figure this out, but
it is, apparently, possible to do something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">server{

  ...
  
  location /tiles/ {
    include uwsgi_params;
    uwsgi_pass 127.0.0.1:9090;
  }
  
  ...

}
</code></pre></div><p>To test the config and restart NGINX, issue:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo service nginx configtest <span style="color:#f92672">&amp;&amp;</span> sudo service nginx reload
</code></pre></div><p>At this point, the service would now be availabe on a standard port at
<code>http://localhost/tiles/</code> or <code>http://&lt;domain name&gt;/tiles/</code> if the server is
available externally.</p>
<img src=assets/000nginxlocal.png class=large alt="http://localhost/tiles/">
<h2 id="tilemill">TileMill</h2>
<p>Setting up a Mapnik source for use with TileStache requires a Mapnik XML file,
and these can be tricky to produce by hand; and iterative refinement is also
cumbersome.  So, it is also useful to install
<a href="https://tilemill-project.github.io/tilemill/">TileMill</a> which provides a nice
editor which can be used to create maps, and export the settings as a Mapnik XML
file.</p>
<h3 id="installation">Installation</h3>
<p>TileMill was originally produced by <a href="http://www.mapbox.com">Mapbox</a>, though it
seems they no longer actively develop it (instead, they encourage the purchase
of <a href="https://www.mapbox.com/mapbox-studio/">Mapbox Studio</a>, which is excellent,
but not free&ndash;enterprises and professionals might want to consider it).  That
said, the project has been forked, and active development is continuing.  We
choose a fork called <a href="https://github.com/florianf/tileoven">TileOven</a>.  To
install it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cd ~/Downloads
git clone https://github.com/florianf/tileoven.git
cd tileoven
npm install
cd
sudo mv ~/Downloads/tileoven /usr/local/
</code></pre></div><p>Of course, this means one must also have both git and node.js.  To install
git:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt-get install git
</code></pre></div><p>To install a newer version of node than is in the repositories, run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cd ~/Downloads
wget https://nodejs.org/dist/v6.9.1/node-v6.9.1-linux-x64.tar.xz
tar -xvf node-v6.9.1-linux-x64.tar.xz
sudo mv node-v6.9.1-linux-x64 /usr/local/node
echo <span style="color:#e6db74">&#34;export PATH=</span>$PATH<span style="color:#e6db74">:/usr/local/node/bin&#34;</span> &gt;&gt; ~/.bashrc
source ~/.bashrc
</code></pre></div><h3 id="testing-the-installation-1">Testing the installation</h3>
<p>To run TileOven, issue:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/usr/local/tileoven/index.js
</code></pre></div><p>Then browse to <code>http://localhost:9090</code> in a web browser and you&rsquo;ll see something
like:</p>
<img src=assets/tileoven.png class=large alt="TileMill (local)">
<h3 id="accessing-tilemill-remotely">Accessing TileMill remotely</h3>
<p>TileMill is currently built to work strictly locally.  This makes it somewhat
awkward to put it on a server and access it from a remote client.  There are
ways, though none is neccesarily ideal.</p>
<p>In one method, the variable <code>listenHost</code> can be set to match the server&rsquo;s public
IP address in the file <code>/usr/local/tileoven/lib/config.defaults.json</code>.  This is
far from secure.</p>
<p>Alternatively, we could rely on SSH tunneling.  The TileMill UI runs on port
20009, and the tile server runs on port 20008; so we just need to forward these
two ports to get access.  On a system with a proper SSH client such as Linux,
we can do something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ssh hostname -l username -L 20009:localhost:20009 20008:localhost:20008
</code></pre></div><p>Then we would simply point our browser at <code>http://localhost:20009</code> to get
access.  From a security perspective, this isn&rsquo;t necessarily an ideal option
either, however.  On my machine, I created a user called <code>gisuser</code> and added
them to a group called <code>gis</code>.  I then made sure this user had limited access,
and used this account to start the TileMill server.</p>
<p>Things are a bit trickier on a Windows platform since it doesn&rsquo;t ship with an
SSH client.  Either way, we will describe how this can work using
<a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/">PuTTY</a>.  I installed using
the installer found
<a href="here">https://the.earth.li/~sgtatham/putty/latest/x86/putty-0.67-installer.msi</a>.</p>
<p>Now, let&rsquo;s assume we have a server running TileMill which can be accessed on a
network by the name <code>debian</code>, or by the IP address <code>192.168.20.22</code> (which is
true for my local network).  We start PuTTY and enter either the hostname or
IP address as follows:</p>
<img src=assets/putty01.png class=large alt="hostname">
<p>Then, navigate to Connection→SSH→Auth→Tunnels, and enter ports
20008 and 20009 as required:</p>
<img src=assets/putty02.png class=large alt="tunnels">
<p>Click the connect button, and you will be asked to enter a username and, and
a terminal will open as follows:</p>
<img src=assets/putty03.png class=large alt="terminal">
<p>The terminal isn&rsquo;t terribly important in this instance since we just want to
acces TileMill.  Simply open a browser and point it at <code>http://localhost:20009</code>
as follows:</p>
<img src=assets/putty01.png class=large alt="TileMill (remote)">
<p>This was done using a remote machine on the same local network as the TileMill
server, but the same process applies over the web&ndash;just use the public IP or
fully qualified name of the server.  For further detail, see:</p>
<p><a href="http://tilemill-project.github.io/tilemill/docs/guides/ubuntu-service/#accessing-tilemill-from-remote-install">Accessing TileMill from remote install</a></p>
<h2 id="postgresql--postgis">PostgreSQL / PostGIS</h2>
<p>While we can render tiles directly from shapefiles and rasters, it is probably
better to pull spatial data from a spatially enabled database.
<a href="https://www.postgresql.org/">PostgreSQL</a> is a high quality, enterprise ready
relational database management system which is freely available; and
<a href="http://www.postgis.net/">PostGIS</a> is an extender which adds spatial
capabilities.  We will describe how to install these products, as well as
populate tables from shapefiles and rasters.</p>
<h3 id="install-postgresql-and-postgis">Install PostgreSQL and PostGIS</h3>
<p>To install PostgreSQL and PostGIS, simply run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt-get install postgresql postgis odbc-postgresql
</code></pre></div><p>The last package, <code>odbc-postgresql</code>, is not strictly necessary, but it will
often be useful to access Postgres via ODBC, and this package provides the
necessary driver.  If you would also like a JDBC driver, you can do:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt-get install libpostgresql-jdbc-java
</code></pre></div><h3 id="create-a-spatially-enabled-database">Create a spatially-enabled database</h3>
<p>We create a single database called <code>gis</code>, and we grant read access to a user
called <code>gisuser</code> with the creative password <code>password</code>.  It makes sense to
group spatial data into collections by creating schemas as appropriate.  In
this case, we create a schema called <code>geography</code> in which we place standard
geographies (meshblock, Area Unit, Territorial Authority, and Regional
Council) as multipolygons.  Similarly, we cteate a schema called <code>raster</code> in
which we will place all raster data.</p>
<p>To gain access to an interactive SQL shell as root:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo -u postgres psql
</code></pre></div><p>And to create the database, run the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> gis;
<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">c</span> gis
<span style="color:#66d9ef">CREATE</span> EXTENSION postgis;
<span style="color:#66d9ef">CREATE</span> EXTENSION postgis_topology;
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">SCHEMA</span> geography;
</code></pre></div><p>We can confirm the spatial extensions are present as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo -u postgres psql -U postgres -d gis -c <span style="color:#e6db74">&#34;SELECT postgis_version()&#34;</span>
</code></pre></div><p>which should return something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">            postgis_version            
---------------------------------------
 2.1 USE_GEOS=1 USE_PROJ=1 USE_STATS=1
(1 row)
</code></pre></div><p>Finally, we give access to the data to user <code>gisuser</code> as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">USER</span> gisuser <span style="color:#66d9ef">WITH</span> <span style="color:#66d9ef">ENCRYPTED</span> PASSWORD <span style="color:#e6db74">&#39;password&#39;</span>;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">CONNECT</span> <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">DATABASE</span> gis <span style="color:#66d9ef">TO</span> gisuser;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">USAGE</span> <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">SCHEMA</span> geography <span style="color:#66d9ef">TO</span> gisuser;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">USAGE</span> <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">SCHEMA</span> raster <span style="color:#66d9ef">TO</span> gisuser;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">ALL</span> TABLES <span style="color:#66d9ef">IN</span> <span style="color:#66d9ef">SCHEMA</span> geography <span style="color:#66d9ef">TO</span> gisuser;
<span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">ALL</span> TABLES <span style="color:#66d9ef">IN</span> <span style="color:#66d9ef">SCHEMA</span> raster <span style="color:#66d9ef">TO</span> gisuser;
</code></pre></div><p>Note that PostGIS supports rasters, but as far as I can tell, TileMill and
Mapnik cannot read PostGIS rasters.  So, we won&rsquo;t bother loading any rasters to
PostGIS here, and will instead just reference the GeoTIFF files directly.</p>
<h3 id="populate-the-database">Populate the database</h3>
<p>It is then relatively easy to load data into the database.  To load the
shapefile <code>&lt;path&gt;/MB2013.*</code> into the database, for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">shp2pgsql -I -s <span style="color:#ae81ff">2193</span> &lt;path&gt;/REGC2013.shp geography.REGC2013 | <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>   sudo -u postgres psql -U postgres -d gis
</code></pre></div><p>And that&rsquo;s it!  Again, we can conduct some simple checks.  For example, the
average area of a meshblock can be calculated by appealing to the <code>ST_Area</code>
function as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">psql -U gisuser -d gis <span style="color:#ae81ff">\ </span>
   -c <span style="color:#e6db74">&#34;SELECT sum(ST_Area(geom)) / sum(1) as ave_area FROM geography.MB2013&#34;</span>
</code></pre></div><p>which, after being prompted for a password, returns:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">     ave_area     
------------------
 5829825.22609488
(1 row)
</code></pre></div><h1 id="serving-tiles">Serving Tiles</h1>
<p>The basic process we will use for deploying tiles will be to first create
and style a map in TileMill, then export to Mapnik XML.  The Mapnik XML file
is referenced from a TileStache configuration, making it available as a tile
server.</p>
<p>We will demonstrate how to add polygon features from both shapefiles and from
PostGIS, and rasters from GeoTIFFs.  For the purpose of this document, we have
sourced features and saved them to <code>/usr/local/tileoven/data</code> as follows:</p>
<ul>
<li><code>MB2013/MB2013.shp</code></li>
<li><code>AU2013/AU2013.shp</code></li>
<li><code>TA2013/TA2013.shp</code></li>
<li><code>REGC2013/REGC2013.shp</code></li>
<li><code>river/river-environment-classification-catchment-order-6-2010.shp</code></li>
<li><code>nitrogen/Nitrogen_Leaching_20150903.tif</code></li>
</ul>
<p>In additions, each of the shapefiles is also stored in a PostGIS database
called <code>gis</code>, schema <code>geography</code>.</p>
<p>For convenience all these files have been placed in the following GitHub
repostiory:</p>
<p><a href="https://github.com/cmhh/spatialdata">spatialdata</a></p>
<h2 id="shapefiles">Shapefiles</h2>
<p>Let&rsquo;s start with the river shapefile.  In the TileMill UI, select &lsquo;Projects&rsquo;
from the sidebar, and then click the &lsquo;+ New project&rsquo;.  Fill in the resulting
dialog as follows:</p>
<img src=assets/river01.png class=large alt="river - create project">
<p>The default map canvas will contain a modestly styled countries feature class
which you can safely delete&ndash;click the layers control
(<img src="assets/layers.png" alt="">), hover over <code>#countries</code>, and click delete
(<img src="assets/delete.png" alt="">).</p>
<p>Next, click the &lsquo;+ Add layer&rsquo; button, and fill in the resulting dialog as
in the following screenshot, before clicking the &lsquo;Save &amp; Style&rsquo; button:</p>
<img src=assets/river02.png class=large alt="river - add layer">
<p>Now edit the <code>style.mss</code> tab so it contains:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">Map {
  background-color: transparent;
}

#river {
  line-color:#594;
  line-width:0.5;
  polygon-opacity:1;
  [Tot_reach &gt;=     0]{ polygon-fill:#EFF3FF; }
  [Tot_reach &gt;=  3000]{ polygon-fill:#BDD7E7; }
  [Tot_reach &gt;=  6000]{ polygon-fill:#6BAED6; }
  [Tot_reach &gt;=  9000]{ polygon-fill:#3182BD; }
  [Tot_reach &gt;= 12000]{ polygon-fill:#08519C; }
}
</code></pre></div><p>Upon clicking the save button, the map should update and (after a little
panning and zooming) looks as follows:</p>
<img src=assets/river03.png class=large alt="river - final map">
<p>To serve a map like this via TileStache, save <code>style.mss</code> as a Mapnik XML file
by clicking the Export button and selecting &lsquo;Mapnik XML&rsquo;.  Save the file as
<code>/etc/tilestache/river.xml</code>.  Then, edit <code>/etc/tilestache/tilestache.cfg</code> to
include a <code>river</code> layer as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">{
  &#34;cache&#34;:
  {
    &#34;name&#34;: &#34;Disk&#34;,
    &#34;path&#34;: &#34;file:///tmp/cache&#34;,
    &#34;umask&#34;: &#34;0000&#34;,
    &#34;dirs&#34;: &#34;portable&#34;
  },
  &#34;layers&#34;:
  {
    &#34;river&#34;:
    {
      &#34;provider&#34;: {&#34;name&#34;: &#34;mapnik&#34;, &#34;mapfile&#34;: &#34;river.xml&#34;}
    },
    
    ...
    
  }
}
</code></pre></div><p>This newly created layer should now be accessible via
<code>&lt;base&gt;/river/{z}/{x}/{y}.png</code>.  As described above, I set TileStache to be
accessible via <code>http://localhost/tiles</code>.  The leaflet package in R provieds us
with a convenient way of testing things are working:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(leaflet)

<span style="color:#a6e22e">leaflet</span>(width<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;100%&#34;</span>, height<span style="color:#f92672">=</span><span style="color:#ae81ff">500</span>) <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">addTiles</span>() <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">fitBounds</span>(<span style="color:#ae81ff">166.70047</span>, <span style="color:#ae81ff">-34.45676</span>, <span style="color:#ae81ff">178.52966</span>, <span style="color:#ae81ff">-47.06345</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">addTiles</span>(urlTemplate <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://localhost/tiles/river/{z}/{x}/{y}.png&#34;</span>)
</code></pre></div><img src=assets/river04.png class=large alt="river - leaflet">
<p>(Of course, you get a live preview of the tiles in TileMill, but we want to
confirm that we can server these via TileStache.  That is, we want to confirm
that we can access the tile server remotely with a &lsquo;Google Maps-style URL&rsquo;.)</p>
<h2 id="postgis">PostGIS</h2>
<p>Now that we&rsquo;re familiar with the general layout, we&rsquo;ll be a little lighter on
detail.  This time, create a project called <code>composite</code> and, as before, delete
the default <code>countries</code> layer.</p>
<p>We will add each of MB2013, AU2013, TA2013, and REGC2013 from PostGIS tables,
though it would be just as easy to add them via shapefiles.  They are all
entered the same way, so we show the setup for just the one, MB2013, as follows:</p>
<img src=assets/composite01.png class=large>
<p>After all 4 layers are added, edit <code>style.mss</code> so it contains the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">Map {
  background-color: transparent;
  maximum-extent: &#34;-19691655, -5989537, 19879128, -4081645&#34;;
}

#MB2013 {
  ::shape{
    [zoom &gt;= 15]{
      line-color:#000000;
      line-width:0.5;
      line-opacity: 1;
      polygon-opacity: 0;
      polygon-fill: transparent;
    }
  }
  ::label{
    [zoom &gt;= 15]{
      text-name: [code];
      text-face-name: &#39;Arial Black Regular&#39;;
      text-fill: #036;
      text-size: 9;
      text-halo-fill: fadeout(white, 30%);
      text-halo-radius: 2.5;
      text-avoid-edges: false;
      text-allow-overlap: true;
      text-placement: interior;
    }
  }
}

#AU2013 {
  ::shape{
    [zoom &gt;= 12][zoom &lt; 15]{
      line-color:#000000;
      line-width:0.5;
      line-opacity: 1;
      polygon-opacity: 0;
      polygon-fill: transparent;
    }
  }
  ::label{
    [zoom &gt;= 12][zoom &lt; 15]{
      text-name: [label] + &#34;\n(&#34; + [code] + &#34;)&#34;;
      text-face-name: &#39;Arial Black Regular&#39;;
      text-fill: #036;
      text-size: 9;
      text-halo-fill: fadeout(white, 30%);
      text-halo-radius: 2.5;
      text-avoid-edges: false;
      text-allow-overlap: true;
      text-placement: interior;
    }
  }
}

#TA2013 {
  ::shape{
    [zoom &gt; 9][zoom &lt; 12]{
      line-color:#000000;
      line-width:0.5;
      line-opacity: 1;
      polygon-opacity: 0;
      polygon-fill: transparent;
    }
  }
  ::label{
    [zoom &gt; 9][zoom &lt; 12]{
      text-name: [label] + &#34;\n(&#34; + [code] + &#34;)&#34;;
      text-face-name: &#39;Arial Black Regular&#39;;
      text-fill: #036;
      text-size: 9;
      text-halo-fill: fadeout(white, 30%);
      text-halo-radius: 2.5;
      text-avoid-edges: false;
      text-allow-overlap: true;
      text-placement: interior;
    }
  }
}

#REGC2013 {
  ::shape{
    [zoom &gt;= 0][zoom &lt;= 9]{
      line-color:#000000;
      line-width:0.5;
      line-opacity: 1;
      polygon-opacity: 0;
      polygon-fill: transparent;
    }
  }
  ::label{
    [zoom &gt;= 0][zoom &lt;= 9]{
      text-name: [label];
      text-face-name: &#39;Arial Black Regular&#39;;
      text-fill: #036;
      text-size: 9;
      text-halo-fill: fadeout(white, 30%);
      text-halo-radius: 2.5;
      text-avoid-edges: false;
      text-allow-overlap: true;
      text-placement: interior;
    }
  }
}
</code></pre></div><p>As before, ws export to Mapnik XML and save as <code>/etc/tilestache/composite.xml</code>,
and edit <code>/etc/tilestache/tilestache.cfg</code> to inculde the new layer:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">{
  &#34;cache&#34;:
  {
    &#34;name&#34;: &#34;Disk&#34;,
    &#34;path&#34;: &#34;file:///tmp/cache&#34;,
    &#34;umask&#34;: &#34;0000&#34;,
    &#34;dirs&#34;: &#34;portable&#34;
  },
  &#34;layers&#34;:
  {
  
    ...
    
    &#34;composite&#34;:
    {
      &#34;provider&#34;: {&#34;name&#34;: &#34;mapnik&#34;, &#34;mapfile&#34;: &#34;composite.xml&#34;}
    }
  }
}
</code></pre></div><p>I won&rsquo;t profess to being very artistic here, but this map will show regional
council areas (REGC2013) when zoomed out, and will change to display more
detailed classifications as we zoom in.  Again, it is easy to view the map in
R:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(leaflet)

<span style="color:#a6e22e">leaflet</span>() <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">addTiles</span>() <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">fitBounds</span>(<span style="color:#ae81ff">166.70047</span>, <span style="color:#ae81ff">-34.45676</span>, <span style="color:#ae81ff">178.52966</span>, <span style="color:#ae81ff">-47.06345</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">addTiles</span>(urlTemplate <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://localhost/tiles/composite/{z}/{x}/{y}.png&#34;</span>)
</code></pre></div><img src=assets/composite02.png class=large>
<img src=assets/composite03.png class=large>
<img src=assets/composite04.png class=large>
<img src=assets/composite05.png class=large>
<h2 id="rasters">Rasters</h2>
<p>Finally, create a new project called <code>nleach</code>, and add the
<code>Nitrogen_Leaching_20150903.tif</code> as follows:</p>
<img src=assets/nleach01.png class=large>
<p>Then edit <code>style.mss</code> as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">Map {
  background-color: transparent;
}

#nleach {
  raster-opacity:1;
  raster-colorizer-default-mode: linear;
  raster-colorizer-default-color: transparent;
  raster-colorizer-stops:
    stop(-0.000005, #FFFFB2)
    stop(13.402771, #FECC5C)
    stop(26.805547, #FD8D3C)
    stop(40.208324, #F03B20)
    stop(53.611100, #BD0026);
}
</code></pre></div><p>Export to Mapnik XML and save as <code>/etc/tilestache/nleach.xml</code>.  Then add the
layer to <code>/etch/tilestache/tilestache.cfg</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">{
  &#34;cache&#34;:
  {
    &#34;name&#34;: &#34;Disk&#34;,
    &#34;path&#34;: &#34;file:///tmp/cache&#34;,
    &#34;umask&#34;: &#34;0000&#34;,
    &#34;dirs&#34;: &#34;portable&#34;
  },
  &#34;layers&#34;:
  {
  
    ...
    
    &#34;composite&#34;:
    {
        &#34;provider&#34;: {&#34;name&#34;: &#34;mapnik&#34;, &#34;mapfile&#34;: &#34;composite.xml&#34;},
        &#34;projection&#34;: &#34;spherical mercator&#34;
    }
  }
}
</code></pre></div><p>Again, we can visualise the result in R:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(leaflet)

<span style="color:#a6e22e">leaflet</span>() <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">addTiles</span>() <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">fitBounds</span>(<span style="color:#ae81ff">166.70047</span>, <span style="color:#ae81ff">-34.45676</span>, <span style="color:#ae81ff">178.52966</span>, <span style="color:#ae81ff">-47.06345</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">addTiles</span>(urlTemplate <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://localhost/tiles/nleach/{z}/{x}/{y}.png&#34;</span>)
</code></pre></div><img src=assets/nleach02.png class=large>
<img src=assets/nleach03.png class=large>
            </div>
        </div>
    </div>
    <div class="column is-3">
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Tags</h1>
        <div class="tags">
        
            <span class="tag"><a href="../../tags/akka">akka</a></span>
        
            <span class="tag"><a href="../../tags/akka-actor">akka-actor</a></span>
        
            <span class="tag"><a href="../../tags/akka-http">akka-http</a></span>
        
            <span class="tag"><a href="../../tags/aws">aws</a></span>
        
            <span class="tag"><a href="../../tags/azure">azure</a></span>
        
            <span class="tag"><a href="../../tags/deeplearning4j">deeplearning4j</a></span>
        
            <span class="tag"><a href="../../tags/docker">docker</a></span>
        
            <span class="tag"><a href="../../tags/geoserver">geoserver</a></span>
        
            <span class="tag"><a href="../../tags/geospark">geospark</a></span>
        
            <span class="tag"><a href="../../tags/geospatial">geospatial</a></span>
        
            <span class="tag"><a href="../../tags/kafka">kafka</a></span>
        
            <span class="tag"><a href="../../tags/nodejs">nodejs</a></span>
        
            <span class="tag"><a href="../../tags/osrm">osrm</a></span>
        
            <span class="tag"><a href="../../tags/postgis">postgis</a></span>
        
            <span class="tag"><a href="../../tags/postgraphile">postgraphile</a></span>
        
            <span class="tag"><a href="../../tags/postgresql">postgresql</a></span>
        
            <span class="tag"><a href="../../tags/postgrest">postgrest</a></span>
        
            <span class="tag"><a href="../../tags/qgis">qgis</a></span>
        
            <span class="tag"><a href="../../tags/r">r</a></span>
        
            <span class="tag"><a href="../../tags/r-packages">r-packages</a></span>
        
            <span class="tag"><a href="../../tags/scala">scala</a></span>
        
            <span class="tag"><a href="../../tags/seasonal-adjustment">seasonal-adjustment</a></span>
        
            <span class="tag"><a href="../../tags/sedona">sedona</a></span>
        
            <span class="tag"><a href="../../tags/shiny">shiny</a></span>
        
            <span class="tag"><a href="../../tags/single-page-web-apps">single-page-web-apps</a></span>
        
            <span class="tag"><a href="../../tags/snowflake">snowflake</a></span>
        
            <span class="tag"><a href="../../tags/spark">spark</a></span>
        
            <span class="tag"><a href="../../tags/tiles">tiles</a></span>
        
            <span class="tag"><a href="../../tags/tilestache">tilestache</a></span>
        
            <span class="tag"><a href="../../tags/vuejs">vuejs</a></span>
        
            <span class="tag"><a href="../../tags/wmts">wmts</a></span>
        
            <span class="tag"><a href="../../tags/wsl2">wsl2</a></span>
        
            <span class="tag"><a href="../../tags/x13-arima-seats">x13-arima-seats</a></span>
        
        </div>          
    </div>
</div><br>
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Recent posts</h1>
        
            <h1><a href="../../2022/2022-04-17-r-spatial-snowflake/">Loading Spatial Data to Snowflake from R</a></h1>
            <time class="has-text-grey-light is-size-7">17 April 2022</time>
        
            <h1><a href="../../2022/2022-03-03-deploying-shiny-apps/">Deploying Shiny Applications</a></h1>
            <time class="has-text-grey-light is-size-7">3 March 2022</time>
        
            <h1><a href="../../2022/2022-02-25-serving_postgis_feautres/">Serving PostGIS Features Over HTTP</a></h1>
            <time class="has-text-grey-light is-size-7">25 February 2022</time>
        
            <h1><a href="../../2022/2022-01-20-too-much-shiny/">Too Much Shiny?!</a></h1>
            <time class="has-text-grey-light is-size-7">20 January 2022</time>
        
            <h1><a href="../../2022/2022-01-09-agent-based-simulations-with-akka/">Agent Based Simulations with Akka</a></h1>
            <time class="has-text-grey-light is-size-7">9 January 2022</time>
        
    </div>
</div>
    <br>
                


    
<br>
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Archives</h1>
        
            <a href="../../archives/2022">2022</a> (5)<br>
        
            <a href="../../archives/2021">2021</a> (4)<br>
        
            <a href="../../archives/2020">2020</a> (4)<br>
        
            <a href="../../archives/2019">2019</a> (1)<br>
        
            <a href="../../archives/2017">2017</a> (1)<br>
        
            <a href="../../archives/2016">2016</a> (4)<br>
        
    </div>
</div>

    </div>
</div>


    </div>
</div>

<footer class="footer has-background-grey-darker has-text-white">
    <div class="content has-text-centered">
        <p>
            <span class="icon is-large"><a href="https://github.com/cmhh" class="mysocial" rel="me"><i class="fab fa-github fa-3x"></i></a></span>&nbsp;&nbsp;
            <span class="icon is-large"><a href="mailto://cmhhansen@outlook.com" class="mysocial" rel="me"><i class="fas fa-envelope fa-3x"></i></a></span>&nbsp;&nbsp;
            <br><br>
            Copyright &copy; cmhh 2022 - Theme by <a href="https://jeffprod.com" class="mysocial">JeffProd.com</a>
        </p>
    </div>
</footer>

<script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js"></script>
<script src="../../js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script src="//yihui.org/js/math-code.js"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>




</body>
</html>
