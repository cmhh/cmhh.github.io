<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>cmhh  | Deploying Shiny Applications</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.min.css" />
    <link href="../../css/highlight/atom-one-dark-reasonable.css" rel='stylesheet' type='text/css' />
    <link rel="stylesheet" href="../../css/blog.css" />
    <link rel="stylesheet" href="../../css/custom.css" />
</head>
<body>

    
    <nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="../../">Home</a>
            
        </div>
    </nav>
    

    
    <section class="hero is-info is-medium">
        <div class="hero-body" style="background-image: url(/img/bg-blog-2.jpg);">
            <div class="container has-text-centered">
                <br>
                <h1 class="title is-size-1">
                    
                        Deploying Shiny Applications
                    
                </h1>
                
            </div>
        </div>
    </section>


<div class="container">
    <div class="section">
    

<div class="columns">
    <div class="column is-9">
        <div class="tile is-child box">
            <div class="content">
                <h1 id="overview">Overview</h1>
<p>In an <a href="../2022-01-20-too-much-shiny">earlier post</a>, we discussed <a href="https://shiny.rstudio.com/">Shiny</a>, a framework for building web applications using R, and suggested that we might be overdoing it a little.  Whether true or not, Shiny is very popular indeed, and so I thought it would be fun to look at how one might go about deploying a Shiny application for public consumption.  So, what follows is just a description of various deployment methods, but note that while Shiny is the focus, <em>some</em> of the deployment methods apply to more general scenariosâ€“notably those approaches based upon containerisation.  The post is on the long side, so we summarise the methods here briefly:</p>
<ul>
<li>deploy using a hosted service, <a href="https://www.shinyapps.io">shinyapps.io</a></li>
<li>deploy locally using an enterprise tool such <a href="https://www.rstudio.com/products/connect/">RStudio Connect</a> (not discussed)</li>
<li>deploy using <a href=""></a></li>
</ul>
<h1 id="an-example-application">An Example Application</h1>
<p>It doesn&rsquo;t really matter what our application is, but for illustration, let us simply use the following simple application throughout:</p>
<div class="tabs-with-content" id="hello-runif-shiny">
<div class="tabs is-boxed">
<ul>
  <li class="is-active"><a>app.R</a></li>
</ul>
</div>
<div>
<section class="tab-content">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(shiny)

ui <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">fluidPage</span>(
  <span style="color:#a6e22e">titlePanel</span>(<span style="color:#e6db74">&#34;Hello runif from Shiny!&#34;</span>),
  <span style="color:#a6e22e">sidebarLayout</span>(
    <span style="color:#a6e22e">sidebarPanel</span>(
      <span style="color:#a6e22e">sliderInput</span>(
        inputId <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;nobs&#34;</span>,
        label <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Number of observations:&#34;</span>,
        min <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, max <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000</span>, value <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>
      )
    ),
    <span style="color:#a6e22e">mainPanel</span>(
      <span style="color:#a6e22e">plotOutput</span>(outputId <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;distPlot&#34;</span>)
    )
  )
)

server <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(input, output) {
  data <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">reactive</span>({
    <span style="color:#a6e22e">runif</span>(input<span style="color:#f92672">$</span>nobs)
  })

  output<span style="color:#f92672">$</span>distPlot <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">renderPlot</span>({
    <span style="color:#a6e22e">hist</span>(
      <span style="color:#a6e22e">data</span>(), col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#75AADB&#34;</span>, border <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>,
      xlab <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;x&#34;</span>,
      main <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;distribution of random uniform numbers&#34;</span>)
    })
}

<span style="color:#a6e22e">shinyApp</span>(ui <span style="color:#f92672">=</span> ui, server <span style="color:#f92672">=</span> server)
</code></pre></div></section>
</div>
</div>
<p>The application looks as follows:</p>
<a href="assets/hello_runif_shiny.webp" target="_blank">
<img src="assets/hello_runif_shiny.webp" class="Large"/></a>
<h1 id="nginx">NGINX</h1>
<p>It is easy enough to run applications locally on some specified or random port.  In real-world applications, though, applications will usually be made available to external users via some sort of reverse proxy.  <a href="https://www.nginx.com/">NGINX</a> is a great choice, and is easy enough to get going.  As with many things these days, the easiest way to get up and running, at least for testing or development purposes, is via a container.  There are official images, and we can get a copy easily (I&rsquo;m using Docker, but things can be modified easily enough for other options, such as podman):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker pull nginx
</code></pre></div><p>An instance suitable for local testing can be stood up easily by running something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run -d --rm --name nginx --network host nginx
</code></pre></div><p>We can gain access to a terminal in the container by running:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker exec -it nginx /bin/bash
</code></pre></div><p>Then, to test configuration changes we edit the file located at <code>/etc/nginx/conf.d/default.conf</code>, then reload NGINX by running:</p>
<pre tabindex="0"><code>service nginx reload
</code></pre><p>Either way, if running properly, visiting <code>localhost</code> or <code>localhost:80</code> should produce something like the following:</p>
<a href="assets/nginx.png" target="_blank">
<img src="assets/nginx.png" class="Large"/></a>
<h1 id="shinyappsio">shinyapps.io</h1>
<p><a href="https://www.rstudio.com/">RStudio</a>, creators of Shiny, offer a decent hosted service, <a href="https://www.shinyapps.io/">shinyapps.io</a>, which is both cheap and easy to use, and is highly recommended for many types of user.  We can demonstrate deployment of our app using the free tier.  First, users need to visit the <a href="https://www.shinyapps.io/">shinyapps.io</a> website and create an account if they haven&rsquo;t already.  Once signed in, open the dashboard, then click &lsquo;Account&rsquo;, then &lsquo;Tokens&rsquo;, and finally &lsquo;Add Token&rsquo;:</p>
<a href="assets/shinyappsio01.png" target="_blank">
<img src="assets/shinyappsio01.png" class="Large"/></a>
<p>Clicking &lsquo;Show&rsquo; will open a dialog, and the token can then safely be copied to your clipboard:</p>
<a href="assets/shinyappsio02.png" target="_blank">
<img src="assets/shinyappsio02.png" class="Large"/></a>
<p>Assuming the <code>rsconnect</code> package is installed, users can then paste and run this code directly in R. This links R to your shinyapps.io account, after which apps can be deployed easily from R.  This is especially easy for RStudio users, where we just click a single button:</p>
<a href="assets/publish01.png" target="_blank">
<img src="assets/publish01.png" class="Large"/></a>
<p>Users will then see a simple dialog as follows:</p>
<a href="assets/publish02.png" target="_blank">
<img src="assets/publish02.png" class="Large"/></a>
<p>After waiting a short while, a web browser should open with the running app:</p>
<a href="assets/publish03.png" target="_blank">
<img src="assets/publish03.png" class="Large"/></a>
<p>Those not using RStudio can deploy using the <code>rsconnect::deployApp</code> function, but we omit the details.  shinyapps.io offers a few nice features, such as the ability to query logs from R, and manage resources assigned to apps via the shinyapps.io dashboard.</p>
<h1 id="shiny-server-open-source">Shiny Server Open Source</h1>
<p><a href="https://www.rstudio.com/products/shiny/download-server/">Shiny Server Open Source</a> is a free server application that lets users host multiple shiny apps easily from a single host.  It is relatively easy to get up and running.  For example, to install on Ubuntu, assuming you already have both R and the <code>shiny</code> package installed, we simply run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo apt-get install gdebi-core
$ wget https://download3.rstudio.org/ubuntu-14.04/x86_64/shiny-server-1.5.17.973-amd64.deb
$ sudo gdebi shiny-server-1.5.17.973-amd64.deb
</code></pre></div><p>I prefer to isolate things from the host, and use containers where possible.  One can get Shiny running via Docker as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ docker pull rocker/shiny
$ docker run -d --rm --name shiny-server --network host -v &lt;path to apps&gt;:/srv/shiny-server rocker/shiny
</code></pre></div><p>If all went well, Shiny Server will be running on port 3838 on the host, and you&rsquo;ll be greeted with the following:</p>
<a href="assets/shinyserver01.png" target="_blank">
<img src="assets/shinyserver01.png" class="Large"/></a>
<p>To make our app available via Shiny Server, all we need to do is copy the application to the <code>/srv/shiny-server</code> folder inside our container.  For example, assuming our app was saved locally as <code>./runif/app.R</code>, and this had been copied to <code>/srv/shiny-server/runif/app.R</code> in the container, we could browse to <code>localhost:3838/runif</code> to see:</p>
<a href="assets/shinyserver02.png" target="_blank">
<img src="assets/shinyserver02.png" class="Large"/></a>
<p>Finally, if NGINX is running on the same host, it easy enough to make Shiny Server available to the public using a location directive as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">server {
  
  location /shiny/ {
    rewrite ^/shiny/(.*)$ /$1 break;
    proxy_pass http://127.0.0.1:3838/;
    proxy_redirect http://127.0.0.1:3838/ $scheme://$host/shiny/;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection &#34;upgrade&#34;;
  }
  
}
</code></pre></div><p>Doing this would mean that our app would be available at both <code>localhost:3838/runif/</code> and <code>localhost/shiny/runif/</code>.  Importantly, external users would be able to reach the app from <code>https://&lt;domain&gt;/shiny/runif/</code>.</p>
<a href="assets/shinyserver03.png" target="_blank">
<img src="assets/shinyserver03.png" class="Large"/></a>
<!--
# RStudio Connect

[RStudio Connect](https://www.rstudio.com/products/connect/) is a commercial product, but it can be installed on a [trial basis](https://www.rstudio.com/products/connect/evaluation/).
-->
<h1 id="r--e---nginx"><code>R -e ...</code> + NGINX</h1>
<p>We can start a Shiny application directly from the terminal with relative ease.  For example, assuming our app is in a folder <code>runif</code>, we could start it on port 3001 as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nohup R -e <span style="color:#e6db74">&#34;shiny::runApp(&#39;runif&#39;, host = &#39;0.0.0.0&#39;, port = 3001)&#34;</span> &gt; runif.log 2&gt;&amp;<span style="color:#ae81ff">1</span> &amp;
</code></pre></div><p>Then, of course, the app will be available on port 3001 on the host:</p>
<a href="assets/basic01.png" target="_blank">
<img src="assets/basic01.png" class="Large"/></a>
<p>As before, if NGINX is running on the same host, it easy enough to make the available to the public using a location directive as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">location /runif/ {
  proxy_pass http://localhost:3001/;
  proxy_http_version 1.1;
  proxy_set_header Upgrade $http_upgrade;
  proxy_set_header Connection &#34;upgrade&#34;;
}
</code></pre></div><p>In this case, the app would then be available generally via <code>localhost/ruif/</code> or  <code>https://&lt;domain&gt;/runif/</code>:</p>
<a href="assets/basic02.png" target="_blank">
<img src="assets/basic02.png" class="Large"/></a>
<h1 id="containerising-shiny-apps">Containerising Shiny Apps</h1>
<p>It is relatively straightforward to containerise an application.  Consider the following Dockerfile:</p>
<div class="tabs-with-content" id="dockerfile01">
<div class="tabs is-boxed">
<ul>
  <li class="is-active"><a>Dockerfile</a></li>
</ul>
</div>
<div>
<section class="tab-content">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> ubuntu:20.04</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> DEBIAN_FRONTEND<span style="color:#f92672">=</span>noninteractive
<span style="color:#66d9ef">ENV</span> SHELL<span style="color:#f92672">=</span>/bin/bash<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span>  apt-get update <span style="color:#f92672">&amp;&amp;</span> apt-get -y dist-upgrade <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  apt install -y --no-install-recommends <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    locales software-properties-common dirmngr wget lsb-release <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  wget -qO- https://cloud.r-project.org/bin/linux/ubuntu/marutter_pubkey.asc | <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    tee -a /etc/apt/trusted.gpg.d/cran_ubuntu_key.asc <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  add-apt-repository <span style="color:#e6db74">&#34;deb https://cloud.r-project.org/bin/linux/ubuntu </span><span style="color:#66d9ef">$(</span>lsb_release -cs<span style="color:#66d9ef">)</span><span style="color:#e6db74">-cran40/&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  apt-get install -y --no-install-recommends r-base r-base-dev <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  sed -i -e <span style="color:#e6db74">&#39;s/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/&#39;</span> /etc/locale.gen <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  dpkg-reconfigure --frontend<span style="color:#f92672">=</span>noninteractive locales <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  update-locale LANG<span style="color:#f92672">=</span>en_US.UTF-8 <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\ </span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  alias make<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/usr/bin/make -j 20&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  R -e <span style="color:#e6db74">&#34;install.packages(c(&#39;shiny&#39;))&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  apt-get remove -y wget lsb-release r-base-dev <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  apt-get autoremove -y <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  apt-get clean -y <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  rm -rf /var/lib/apt/lists/*<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 3838</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> R -e <span style="color:#e6db74">&#34;shiny::runApp(&#39;/app&#39;, host = &#39;0.0.0.0&#39;, port = 3838)&#34;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div></section>
</div>
</div>
<p>We can build this image as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker build -t shiny .
</code></pre></div><p>To start our test application on port 3001, say, we&rsquo;d then simply run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run --rm --name runifapp -p 3001:3838 -v &lt;path to runif&gt;/runif:/app shiny
</code></pre></div><p>(Note that the <code>Dockerfile</code> described isn&rsquo;t generally useful since we&rsquo;d need to ensure considerably more R packages were available to be sure that any particular Shiny app would run correctly.)</p>
<h1 id="shinyproxy">ShinyProxy</h1>
<p><a href="https://shinyproxy.io/">ShinyProxy</a> is similar to Shiny Server in that it can be used to deploy multiple shiny applications easily on a single host.  However, while it is completely open source, it still supports a number of useful enterprise features, such as LDAP authentication.  Under the hood, ShinyProxy runs applications by spinning up containers on demand, which is neat!</p>
<p>Installation is easy enough.  Of course, Docker needs to be installed and running, but ShinyProxy needs TCP access in order to start containers.  This varies by system, but for systems using systemd we can just run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo systemctl edit docker
</code></pre></div><p>and then add the following lines in the appropriate place (comments make it clear where):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">[Service]
ExecStart=
ExecStart=/usr/bin/dockerd -H unix:// -D -H tcp://127.0.0.1:2375
</code></pre></div><p>But something like:</p>
<a href="assets/systemd.png" target="_blank">
<img src="assets/systemd.png" class="Large"/></a>
<p>Then we simply download a copy of ShinyProxy from the <a href="https://shinyproxy.io/downloads/">ShinyProxy downloads</a> page.  At the time of writing, the most recent version is <a href="https://shinyproxy.io/downloads/shinyproxy-2.6.0.jar">2.6.0</a>.
It is way beyond the scope of a short post such as this to cover ShinyProxy in great detail, so we consider just a very simple setup.  Assume first that the Docker image, shiny, as described above exists.  Further assume that the following file exists in the same directory as the ShinyProxy jar:</p>
<div class="tabs-with-content" id="shinyproxyconf">
<div class="tabs is-boxed">
<ul>
  <li class="is-active"><a>application.yml</a></li>
</ul>
</div>
<div>
<section class="tab-content">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">server</span>: 
  <span style="color:#f92672">servlet</span>:
    <span style="color:#f92672">context-path</span>: <span style="color:#ae81ff">/shinyproxy</span>
<span style="color:#f92672">proxy</span>:
  <span style="color:#f92672">title</span>: <span style="color:#ae81ff">My Shiny Proxy</span>
  <span style="color:#f92672">logo-url</span>: <span style="color:#ae81ff">https://www.openanalytics.eu/shinyproxy/logo.png</span>
  <span style="color:#f92672">landing-page</span>: <span style="color:#ae81ff">/</span>
  <span style="color:#f92672">heartbeat-rate</span>: <span style="color:#ae81ff">10000</span>
  <span style="color:#f92672">heartbeat-timeout</span>: <span style="color:#ae81ff">60000</span>
  <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8081</span>
  <span style="color:#f92672">authentication</span>: <span style="color:#ae81ff">none</span>
  <span style="color:#f92672">docker</span>:
    <span style="color:#f92672">cert-path</span>: <span style="color:#ae81ff">/home/none</span>
    <span style="color:#f92672">url</span>: <span style="color:#ae81ff">http://localhost:2375</span>
    <span style="color:#f92672">port-range-start</span>: <span style="color:#ae81ff">20000</span>
  <span style="color:#f92672">specs</span>:
  - <span style="color:#f92672">id</span>: <span style="color:#ae81ff">runif</span>
    <span style="color:#f92672">display-name</span>: <span style="color:#ae81ff">runif</span>
    <span style="color:#f92672">description</span>: <span style="color:#ae81ff">Historgram of a random uniform sequence</span>
    <span style="color:#f92672">container-image</span>: <span style="color:#ae81ff">shiny</span>
    <span style="color:#f92672">container-volumes</span>: [ <span style="color:#e6db74">&#34;&lt;/path/to/shiny/app&gt;/runif:/app&#34;</span> ]

<span style="color:#f92672">logging</span>:
  <span style="color:#f92672">file</span>:
    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">shinyproxy.log</span>
</code></pre></div></section>
</div>
</div>
<p>We then start ShinyProxy by running:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">java -jar shinyproxy-2.6.0.jar 
</code></pre></div><p>Given the config, ShinyProxy will then be running on port 8081.  A landing page will be available at <code>localhost:8081/shinyproxy</code>:</p>
<a href="assets/shinyproxy01.png" target="_blank">
<img src="assets/shinyproxy01.png" class="Large"/></a>
<p>We can click the <code>runif</code> link to get to our app, or just navigate directly to <code>localhost:8081/shinyproxy/app/runif</code>:</p>
<a href="assets/shinyproxy02.png" target="_blank">
<img src="assets/shinyproxy02.png" class="Large"/></a>
<p>As in earlier examples, we can use NGINX to proxy easily enough.  A sufficient location directive in this case would be (note that the location must match the <code>context-path</code> field from <code>application.yml</code>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">location /shinyproxy/ {
  proxy_pass http://localhost:8081/shinyproxy/;
  proxy_http_version 1.1;
  proxy_set_header Upgrade $http_upgrade;
  proxy_set_header Connection &#34;upgrade&#34;;
}
</code></pre></div><p>ShinyProxy will then be available at <code>localhost/shinyproxy/</code>, or externally at <code>https://&lt;domain&gt;/shinyproxy/</code>:</p>
<a href="assets/shinyproxy03.png" target="_blank">
<img src="assets/shinyproxy03.png" class="Large"/></a>
<h1 id="our-container-revisited">Our Container Revisited&hellip;</h1>
<p>In the next example we&rsquo;ll deploy a Shiny app to a cloud-hosted service, and we&rsquo;ll do so using a container.  We&rsquo;ll want our container to be self contained, so we&rsquo;d prefer our app to be copied into the image.  So, let us define a new container which we&rsquo;ll use for the rest of this blog, defined by the following <code>Dockerfile</code> (where, of course, our build context contains our app in a folder <code>runif</code>):</p>
<div class="tabs-with-content" id="runifapp">
<div class="tabs is-boxed">
<ul>
  <li class="is-active"><a>Dockerfile</a></li>
</ul>
</div>
<div>
<section class="tab-content">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> ubuntu:20.04</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> DEBIAN_FRONTEND<span style="color:#f92672">=</span>noninteractive
<span style="color:#66d9ef">ENV</span> SHELL<span style="color:#f92672">=</span>/bin/bash<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span>  apt-get update <span style="color:#f92672">&amp;&amp;</span> apt-get -y dist-upgrade <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  apt install -y --no-install-recommends <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    locales software-properties-common dirmngr wget lsb-release <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  wget -qO- https://cloud.r-project.org/bin/linux/ubuntu/marutter_pubkey.asc | <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    tee -a /etc/apt/trusted.gpg.d/cran_ubuntu_key.asc <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  add-apt-repository <span style="color:#e6db74">&#34;deb https://cloud.r-project.org/bin/linux/ubuntu </span><span style="color:#66d9ef">$(</span>lsb_release -cs<span style="color:#66d9ef">)</span><span style="color:#e6db74">-cran40/&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  apt-get install -y --no-install-recommends r-base r-base-dev <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  sed -i -e <span style="color:#e6db74">&#39;s/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/&#39;</span> /etc/locale.gen <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  dpkg-reconfigure --frontend<span style="color:#f92672">=</span>noninteractive locales <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  update-locale LANG<span style="color:#f92672">=</span>en_US.UTF-8 <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\ </span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  alias make<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/usr/bin/make -j 20&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  R -e <span style="color:#e6db74">&#34;install.packages(c(&#39;shiny&#39;))&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  apt-get remove -y wget lsb-release r-base-dev <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  apt-get autoremove -y <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  apt-get clean -y <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  rm -rf /var/lib/apt/lists/*<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> runif /app/<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 3838</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> R -e <span style="color:#e6db74">&#34;shiny::runApp(&#39;/app&#39;, host = &#39;0.0.0.0&#39;, port = 3838)&#34;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div></section>
</div>
</div>
<h1 id="azure-app-services">Azure App Services</h1>
<p>Azure is the suite of cloud services managed by Microsoft, and there are several viable options for doing something like deploying a Shiny app.  We can deploy things manually on a remote virtual machine using approaches already outlined above, but one reasonable option is to deploy a container using <a href="https://azure.microsoft.com/en-us/services/app-service/">Azure App Service</a>.  Note that most things can be done on Azure either through the Azure Portal using a largely point-and-click interface, or at the command-line using <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli">Azure CLI</a>.  We&rsquo;ll use the portal here where possible, but the CLI will still be required.  Either way, we assume interested readers have access to an Azure account (and, hence, the portal) already, and have also installed the CLI themselves.</p>
<p>First, we need to create an <a href="https://azure.microsoft.com/en-us/services/container-registry/">Azure Container Registry</a>.  There&rsquo;s a few ways to get there, but one way is to click &lsquo;All services&rsquo;&hellip;</p>
<a href="assets/acr01.png" target="_blank">
<img src="assets/acr01.png" class="Large"/></a>
<p>&hellip;then select &lsquo;Containers&rsquo; from the &lsquo;Categories&rsquo; menu, and then &lsquo;Container registries&rsquo;&hellip;</p>
<a href="assets/acr02.png" target="_blank">
<img src="assets/acr02.png" class="Large"/></a>
<p>&hellip;then click &lsquo;Create&rsquo;&hellip;</p>
<a href="assets/acr03.png" target="_blank">
<img src="assets/acr03.png" class="Large"/></a>
<p>and, finally, we are presented with a form which is straightforward to complete&hellip;</p>
<a href="assets/acr04.png" target="_blank">
<img src="assets/acr04.png" class="Large"/></a>
<p>At this point, we need to push our container to the registry.  We first need to connect to the container registry on whichever machine our image resides.  To do this we first connect to Azure by runing:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">az login
</code></pre></div><p>A browser window will open and await your Azure credentials, after which you&rsquo;ll be logged in.  Then, we connect to the registry:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">az acr login --name myregistry
</code></pre></div><p>Then, to push the <code>runifapp</code> image:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ docker tag runifapp myregsitry.azurecr.io/test/runifapp
$ docker push runifapp.azurecr.io/test/runifapp
</code></pre></div><p>After this, we can deploy the image simply by browsing to the image and clicking &lsquo;Deploy to web app&rsquo; from the available context menu (note you will also need to have an &lsquo;App Service Plan&rsquo; available, but there&rsquo;s only so much we can cover here!):</p>
<a href="assets/acr05.png" target="_blank">
<img src="assets/acr05.png" class="Large"/></a>
<p>It can take a long time to deploy, but once up and running, you&rsquo;ll be able to find an external link from the main resource page:</p>
<a href="assets/acr06.png" target="_blank">
<img src="assets/acr06.png" class="Large"/></a>
<a href="assets/acr07.png" target="_blank">
<img src="assets/acr07.png" class="Large"/></a>
<p>Note that Shiny applications require WebSockets availability, so make sure this is enabled and save yourself a bunch of frustration!</p>
<a href="assets/acr08.png" target="_blank">
<img src="assets/acr08.png" class="Large"/></a>
<h1 id="aws">AWS</h1>
<p>Their are a few options for deploying Shiny apps on AWS.  Again, we could deploy manually on an EC2 instance, using containers or not.  But otherwise we <em>ought</em> to be able to do this via Elastic Beanstalk, or else by first pushing our image to Elastic Container Registry, and then deploying via Elastic Container Service.  I had a quick go at the latter, but the setup became reasonably involved, involving internet gateways and so on, so I decided it to leave it for this post.  AWS App Runner <em>looks</em> like a much simpler option and I was able to deploy the app using this, only to find out App Runner does not support WebSockets and the deployed app didn&rsquo;t work correctly.  Hopefully Amazon add WebSocket support to App Runner soon.</p>
<script src='../../js/tabs.js'></script>
            </div>
        </div>
    </div>
    <div class="column is-3">
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Tags</h1>
        <div class="tags">
        
            <span class="tag"><a href="../../tags/akka">akka</a></span>
        
            <span class="tag"><a href="../../tags/akka-actor">akka-actor</a></span>
        
            <span class="tag"><a href="../../tags/akka-http">akka-http</a></span>
        
            <span class="tag"><a href="../../tags/aws">aws</a></span>
        
            <span class="tag"><a href="../../tags/azure">azure</a></span>
        
            <span class="tag"><a href="../../tags/deeplearning4j">deeplearning4j</a></span>
        
            <span class="tag"><a href="../../tags/docker">docker</a></span>
        
            <span class="tag"><a href="../../tags/geoserver">geoserver</a></span>
        
            <span class="tag"><a href="../../tags/geospark">geospark</a></span>
        
            <span class="tag"><a href="../../tags/geospatial">geospatial</a></span>
        
            <span class="tag"><a href="../../tags/kafka">kafka</a></span>
        
            <span class="tag"><a href="../../tags/nodejs">nodejs</a></span>
        
            <span class="tag"><a href="../../tags/osrm">osrm</a></span>
        
            <span class="tag"><a href="../../tags/postgis">postgis</a></span>
        
            <span class="tag"><a href="../../tags/postgraphile">postgraphile</a></span>
        
            <span class="tag"><a href="../../tags/postgresql">postgresql</a></span>
        
            <span class="tag"><a href="../../tags/postgrest">postgrest</a></span>
        
            <span class="tag"><a href="../../tags/qgis">qgis</a></span>
        
            <span class="tag"><a href="../../tags/r">r</a></span>
        
            <span class="tag"><a href="../../tags/r-packages">r-packages</a></span>
        
            <span class="tag"><a href="../../tags/scala">scala</a></span>
        
            <span class="tag"><a href="../../tags/seasonal-adjustment">seasonal-adjustment</a></span>
        
            <span class="tag"><a href="../../tags/sedona">sedona</a></span>
        
            <span class="tag"><a href="../../tags/shiny">shiny</a></span>
        
            <span class="tag"><a href="../../tags/single-page-web-apps">single-page-web-apps</a></span>
        
            <span class="tag"><a href="../../tags/snowflake">snowflake</a></span>
        
            <span class="tag"><a href="../../tags/spark">spark</a></span>
        
            <span class="tag"><a href="../../tags/tiles">tiles</a></span>
        
            <span class="tag"><a href="../../tags/tilestache">tilestache</a></span>
        
            <span class="tag"><a href="../../tags/vuejs">vuejs</a></span>
        
            <span class="tag"><a href="../../tags/wmts">wmts</a></span>
        
            <span class="tag"><a href="../../tags/wsl2">wsl2</a></span>
        
            <span class="tag"><a href="../../tags/x13-arima-seats">x13-arima-seats</a></span>
        
        </div>          
    </div>
</div><br>
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Recent posts</h1>
        
            <h1><a href="../../2022/2022-04-17-r-spatial-snowflake/">Loading Spatial Data to Snowflake from R</a></h1>
            <time class="has-text-grey-light is-size-7">17 April 2022</time>
        
            <h1><a href="../../2022/2022-03-03-deploying-shiny-apps/">Deploying Shiny Applications</a></h1>
            <time class="has-text-grey-light is-size-7">3 March 2022</time>
        
            <h1><a href="../../2022/2022-02-25-serving_postgis_feautres/">Serving PostGIS Features Over HTTP</a></h1>
            <time class="has-text-grey-light is-size-7">25 February 2022</time>
        
            <h1><a href="../../2022/2022-01-20-too-much-shiny/">Too Much Shiny?!</a></h1>
            <time class="has-text-grey-light is-size-7">20 January 2022</time>
        
            <h1><a href="../../2022/2022-01-09-agent-based-simulations-with-akka/">Agent Based Simulations with Akka</a></h1>
            <time class="has-text-grey-light is-size-7">9 January 2022</time>
        
    </div>
</div>
    <br>
                
  



<div class="card">
    <div class="card-content">
        <h1 class="title is-5">Related posts</h1>
      
      
            <h1><a href="../../2022/2022-04-17-r-spatial-snowflake/">Loading Spatial Data to Snowflake from R</a></h1>
            <time class="has-text-grey-light is-size-7">17 April 2022</time>
      
            <h1><a href="../../2022/2022-01-20-too-much-shiny/">Too Much Shiny?!</a></h1>
            <time class="has-text-grey-light is-size-7">20 January 2022</time>
      
            <h1><a href="../../2020/2020-12-05-working-productively-on-windows-using-wsl2-and-docker/">Working Productively on Windows Using Windows Subsystem for Linux 2 and Docker</a></h1>
            <time class="has-text-grey-light is-size-7">5 December 2020</time>
      
            <h1><a href="../../2020/2020-10-31-docker-on-windows-with-wsl2/">Docker on Windows with Windows Subsystem for Linux 2</a></h1>
            <time class="has-text-grey-light is-size-7">31 October 2020</time>
      
            <h1><a href="../../2020/2020-10-31-using-postgis-as-a-spatial-backend-for-r/">Using PostGIS as a Spatial Backend for R</a></h1>
            <time class="has-text-grey-light is-size-7">31 October 2020</time>
      
            <h1><a href="../../2019/2019-09-17-building-tile-services-on-the-fly-with-geoserver/">Building Tile Services on-the-fly with GeoServer</a></h1>
            <time class="has-text-grey-light is-size-7">17 September 2019</time>
      
            <h1><a href="../../2016/2016-11-27-routing-in-r-using-osrm/">Routing in R Using the Open Source Routing Machine (OSRM)</a></h1>
            <time class="has-text-grey-light is-size-7">27 November 2016</time>
      
    </div>
</div>

    
<br>
        <div class="card">
    <div class="card-content">
        <h1 class="title is-5">Archives</h1>
        
            <a href="../../archives/2022">2022</a> (5)<br>
        
            <a href="../../archives/2021">2021</a> (4)<br>
        
            <a href="../../archives/2020">2020</a> (4)<br>
        
            <a href="../../archives/2019">2019</a> (1)<br>
        
            <a href="../../archives/2017">2017</a> (1)<br>
        
            <a href="../../archives/2016">2016</a> (4)<br>
        
    </div>
</div>

    </div>
</div>


    </div>
</div>

<footer class="footer has-background-grey-darker has-text-white">
    <div class="content has-text-centered">
        <p>
            <span class="icon is-large"><a href="https://github.com/cmhh" class="mysocial" rel="me"><i class="fab fa-github fa-3x"></i></a></span>&nbsp;&nbsp;
            <span class="icon is-large"><a href="mailto://cmhhansen@outlook.com" class="mysocial" rel="me"><i class="fas fa-envelope fa-3x"></i></a></span>&nbsp;&nbsp;
            <br><br>
            Copyright &copy; cmhh 2022 - Theme by <a href="https://jeffprod.com" class="mysocial">JeffProd.com</a>
        </p>
    </div>
</footer>

<script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js"></script>
<script src="../../js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script src="//yihui.org/js/math-code.js"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>




</body>
</html>
